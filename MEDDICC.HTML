<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEDDICC Deal Review</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0A1628 0%, #1a2942 100%);
            color: #ffffff;
            padding: 40px 20px;
            min-height: 100vh;
        }

        .controls {
            max-width: 1600px;
            margin: 0 auto 20px auto;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 999px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        }

        .controls-bar {
            max-width: 1600px;
            margin: 0 auto 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 18px 35px rgba(0,0,0,0.45);
            backdrop-filter: blur(14px);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            align-items: center;
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #ffffff;
            box-shadow: 0 8px 20px rgba(0,0,0,0.35);
            white-space: nowrap;
        }

        .control-btn:hover {
            transform: translateY(-1px);
            filter: brightness(1.08);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .client-selector label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8);
        }

        .client-selector select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
            background: rgba(10, 22, 40, 0.9);
            color: #ffffff;
            outline: none;
        }

        .client-selector select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 1px rgba(102,126,234,0.7);
        }

        .save-indicator {
            text-align: right;
            margin-top: 10px;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.6);
        }

        .page {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255,255,255,0.04);
            box-shadow: 0 25px 50px rgba(0,0,0,0.7);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.12);
            backdrop-filter: blur(18px);
        }

        .header {
            background: radial-gradient(circle at top left, rgba(102,126,234,0.25), transparent);
            color: #ffffff;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            border-bottom: 1px solid rgba(255,255,255,0.15);
        }

        .header-title-block {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .header-title-block span {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: rgba(255,255,255,0.7);
        }

        .header h1 {
            font-size: 1.8rem;
            letter-spacing: 0.35em;
            font-weight: 300;
            text-transform: uppercase;
        }

        .header-sub {
            font-size: 0.8rem;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.7);
        }

        /* Deal Basics */
        .deal-basics {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr;
            gap: 0;
            border-bottom: 1px solid rgba(255,255,255,0.15);
        }

        .deal-column {
            border-right: 1px solid rgba(255,255,255,0.15);
        }

        .deal-column:last-child {
            border-right: none;
        }

        .field-row {
            display: grid;
            grid-template-columns: 140px 1fr;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .field-label {
            background: rgba(10, 22, 40, 0.9);
            padding: 10px 14px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: rgba(255,255,255,0.85);
            border-right: 1px solid rgba(255,255,255,0.15);
        }

        .field-input {
            padding: 10px 14px;
            background: rgba(255,255,255,0.02);
        }

        .field-input input,
        .field-input select {
            width: 100%;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(10,22,40,0.95);
            color: #ffffff;
            padding: 6px 8px;
            font-size: 0.85rem;
            outline: none;
        }

        .field-input input::placeholder {
            color: rgba(255,255,255,0.4);
        }

        .health-row {
            padding: 12px 14px;
            background: radial-gradient(circle at top, rgba(102,126,234,0.18), rgba(10,22,40,0.9));
            border-bottom: 1px solid rgba(255,255,255,0.15);
            font-size: 0.8rem;
        }

        .health-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .health-item {
            display: flex;
            flex-direction: column;
            gap: 3px;
            font-size: 0.75rem;
        }

        .health-item label {
            color: rgba(255,255,255,0.8);
        }

        .health-item input {
            width: 100%;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(10,22,40,0.95);
            color: #ffffff;
            padding: 4px 6px;
            font-size: 0.75rem;
        }

        /* MEDDICC Grid */
        .meddicc-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.15);
        }

        .meddicc-card {
            background: rgba(5,15,30,0.9);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.12);
            padding: 12px;
            font-size: 0.8rem;
            box-shadow: 0 12px 28px rgba(0,0,0,0.45);
        }

        .meddicc-header {
            display: flex;
            align-items: baseline;
            gap: 6px;
            margin-bottom: 8px;
        }

        .meddicc-letter {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .meddicc-title {
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.9);
        }

        .meddicc-sub {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.6);
        }

        .meddicc-field {
            margin-top: 6px;
        }

        .meddicc-label {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 2px;
        }

        .meddicc-field input,
        .meddicc-field textarea,
        .meddicc-field select {
            width: 100%;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(10,22,40,0.95);
            color: #ffffff;
            padding: 6px 8px;
            font-size: 0.8rem;
            outline: none;
        }

        .meddicc-field textarea {
            min-height: 50px;
            resize: vertical;
        }

        .meddicc-field input::placeholder,
        .meddicc-field textarea::placeholder {
            color: rgba(255,255,255,0.4);
        }

        /* Bottom Section */
        .bottom-section {
            display: grid;
            grid-template-columns: 1.3fr 1.3fr 1.4fr;
            border-top: 1px solid rgba(255,255,255,0.15);
        }

        .bottom-box {
            border-right: 1px solid rgba(255,255,255,0.15);
            min-height: 200px;
        }

        .bottom-box:last-child {
            border-right: none;
        }

        .bottom-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 15px;
            font-weight: 600;
            text-align: center;
            font-size: 0.9rem;
            letter-spacing: 0.08em;
        }

        .bottom-content {
            padding: 16px;
            background: rgba(15,27,48,0.95);
        }

        .bottom-content textarea {
            width: 100%;
            min-height: 130px;
            border: 1px solid rgba(203,213,224,0.9);
            padding: 10px;
            font-size: 0.85rem;
            border-radius: 8px;
            background: rgba(5,15,30,0.95);
            color: #ffffff;
        }

        .bottom-content textarea::placeholder {
            color: rgba(255,255,255,0.4);
        }

        .action-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .action-table th {
            background: rgba(237,242,247,0.1);
            padding: 8px;
            border: 1px solid rgba(203,213,224,0.4);
            font-size: 0.75rem;
            color: rgba(255,255,255,0.85);
        }

        .action-table td {
            padding: 8px;
            border: 1px solid rgba(203,213,224,0.4);
            background: rgba(5,15,30,0.9);
        }

        .action-table input {
            width: 100%;
            border: 1px solid rgba(226,232,240,0.9);
            font-size: 0.8rem;
            padding: 6px;
            border-radius: 4px;
            background: rgba(10,22,40,0.95);
            color: #ffffff;
        }

        .delete-row-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            box-shadow: 0 4px 10px rgba(229,62,62,0.5);
        }

        .add-row-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            margin-top: 10px;
            cursor: pointer;
            font-size: 0.8rem;
            border-radius: 999px;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(56,161,105,0.5);
            transition: all 0.3s ease;
        }

        .add-row-btn:hover {
            transform: translateY(-1px);
            filter: brightness(1.05);
        }

        /* ---------- LIGHT THEME OVERRIDES ---------- */

        body.light-theme {
            background: linear-gradient(135deg, #f7fafc 0%, #e2e8f0 100%);
            color: #1a202c;
        }

        body.light-theme .controls-bar {
            background: #ffffff;
            border-color: #e2e8f0;
            box-shadow: 0 12px 24px rgba(148,163,184,0.35);
        }

        body.light-theme .btn {
            background: #ffffff;
            color: #2d3748;
            border-color: #cbd5e0;
        }

        body.light-theme .btn:hover {
            background: #edf2ff;
            border-color: #667eea;
            color: #1a202c;
        }

        body.light-theme .page {
            background: #ffffff;
            border-color: #e2e8f0;
            box-shadow: 0 20px 40px rgba(148,163,184,0.5);
            backdrop-filter: none;
        }

        body.light-theme .header {
            background: linear-gradient(135deg, #edf2ff 0%, #e9d8fd 100%);
            color: #1a202c;
            border-bottom-color: #e2e8f0;
        }

        body.light-theme .header-title-block span {
            color: #4a5568;
        }

        body.light-theme .header-sub {
            color: #4a5568;
        }

        body.light-theme .deal-basics {
            border-bottom-color: #e2e8f0;
        }

        body.light-theme .deal-column {
            border-right-color: #e2e8f0;
        }

        body.light-theme .field-row {
            border-bottom-color: #e2e8f0;
        }

        body.light-theme .field-label {
            background: #f7fafc;
            color: #2d3748;
            border-right-color: #e2e8f0;
        }

        body.light-theme .field-input {
            background: #ffffff;
        }

        body.light-theme .field-input input,
        body.light-theme .field-input select {
            background: #ffffff;
            border-color: #cbd5e0;
            color: #1a202c;
        }

        body.light-theme .field-input input::placeholder {
            color: #a0aec0;
        }

        body.light-theme .health-row {
            background: #edf2f7;
            border-bottom-color: #e2e8f0;
            color: #2d3748;
        }

        body.light-theme .health-item label {
            color: #2d3748;
        }

        body.light-theme .health-item input {
            background: #ffffff;
            border-color: #cbd5e0;
            color: #1a202c;
        }

        body.light-theme .meddicc-grid {
            border-bottom-color: #e2e8f0;
        }

        body.light-theme .meddicc-card {
            background: #f8fafc;
            border-color: #e2e8f0;
            box-shadow: 0 8px 18px rgba(148,163,184,0.35);
            color: #1a202c;
        }

        body.light-theme .meddicc-title {
            color: #1a202c;
        }

        body.light-theme .meddicc-sub {
            color: #4a5568;
        }

        body.light-theme .meddicc-label {
            color: #4a5568;
        }

        body.light-theme .meddicc-field input,
        body.light-theme .meddicc-field textarea,
        body.light-theme .meddicc-field select {
            background: #ffffff;
            border-color: #cbd5e0;
            color: #1a202c;
        }

        body.light-theme .meddicc-field input::placeholder,
        body.light-theme .meddicc-field textarea::placeholder {
            color: #a0aec0;
        }

        body.light-theme .bottom-section {
            border-top-color: #e2e8f0;
        }

        body.light-theme .bottom-box {
            border-right-color: #e2e8f0;
        }

        body.light-theme .bottom-header {
            /* keep gradient, just slightly lighter text tone */
            color: #f7fafc;
        }

        body.light-theme .bottom-content {
            background: #f7fafc;
        }

        body.light-theme .bottom-content textarea {
            background: #ffffff;
            border-color: #cbd5e0;
            color: #1a202c;
        }

        body.light-theme .bottom-content textarea::placeholder {
            color: #a0aec0;
        }

        body.light-theme .action-table th {
            background: #edf2f7;
            border-color: #cbd5e0;
            color: #2d3748;
        }

        body.light-theme .action-table td {
            background: #ffffff;
            border-color: #e2e8f0;
        }

        body.light-theme .action-table input {
            background: #ffffff;
            border-color: #cbd5e0;
            color: #1a202c;
        }

        body.light-theme .save-indicator {
            color: #4a5568;
        }

        body.light-theme .controls-bar .control-btn {
            box-shadow: 0 8px 18px rgba(148,163,184,0.35);
        }

        @media (max-width: 1200px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
            .deal-basics {
                grid-template-columns: 1fr;
            }
            .meddicc-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 20px 10px;
            }
            .page {
                border-radius: 14px;
            }
            .header {
                flex-direction: column;
                gap: 6px;
            }
            .meddicc-grid {
                grid-template-columns: 1fr;
            }
            .bottom-section {
                grid-template-columns: 1fr;
            }
        }

        @media print {
            body {
                background: #ffffff;
                color: #000000;
                padding: 0;
            }
            .controls,
            .controls-bar,
            .add-row-btn,
            .delete-row-btn {
                display: none !important;
            }
            .page {
                box-shadow: none;
                border-radius: 0;
                border: none;
            }
        }
    </style>
</head>
<body>

<div class="controls">
    <button class="btn" onclick="window.location.href='index.html'">‚Üê Back to Playbook Hub</button>
</div>

<div class="controls-bar">
    <div class="controls-grid">
        <div class="client-selector">
            <label>Select Deal (MEDDICC):</label>
            <select id="deal-select" onchange="switchDeal(this.value)"></select>
        </div>
        <div class="action-buttons">
            <button class="control-btn" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);" onclick="createNewDeal()">+ New</button>
            <button class="control-btn" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);" onclick="loadSampleDeal()">üìù Sample</button>
            <button class="control-btn" style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);" onclick="exportToPDF()">üìÑ PDF</button>
            <!-- PPTX button stays here if you're still using it -->
            <button class="control-btn" style="background: linear-gradient(135deg, #3182ce 0%, #2b6cb0 100%);" onclick="exportToPPT()">üìä PPTX</button>
            <!-- NEW THEME TOGGLE BUTTON -->
            <button class="control-btn" style="background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);" onclick="toggleTheme()">üåì Theme</button>
            <button class="control-btn" style="background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);" onclick="manualSave()">üíæ Save</button>
        </div>
    </div>
    <div class="save-indicator">
        <span id="save-indicator">üü¢ Auto-save enabled</span>
    </div>
</div>

<div class="page">
    <div class="header">
        <div class="header-title-block">
            <span>Deal Qualification Framework</span>
            <h1>MEDDICC</h1>
        </div>
        <div class="header-sub">Metrics ‚Ä¢ Economic Buyer ‚Ä¢ Decision Criteria ‚Ä¢ Decision Process ‚Ä¢ Identify Pain ‚Ä¢ Champion ‚Ä¢ Competition</div>
    </div>

    <!-- Deal Basics -->
    <div class="deal-basics">
        <div class="deal-column">
            <div class="field-row">
                <div class="field-label">Account</div>
                <div class="field-input">
                    <input type="text" id="account" placeholder="Enter account name">
                </div>
            </div>
            <div class="field-row">
                <div class="field-label">Opportunity</div>
                <div class="field-input">
                    <input type="text" id="opportunity" placeholder="Name / description of the opportunity">
                </div>
            </div>
        </div>
        <div class="deal-column">
            <div class="field-row">
                <div class="field-label">Owner</div>
                <div class="field-input">
                    <input type="text" id="owner" placeholder="Deal owner / AE">
                </div>
            </div>
            <div class="field-row">
                <div class="field-label">Stage</div>
                <div class="field-input">
                    <select id="stage">
                        <option value="">Select stage</option>
                        <option value="1 - Discovery">1 - Discovery</option>
                        <option value="2 - Qualification">2 - Qualification</option>
                        <option value="3 - Evaluation">3 - Evaluation</option>
                        <option value="4 - Proposal">4 - Proposal</option>
                        <option value="5 - Negotiation">5 - Negotiation</option>
                        <option value="6 - Commit">6 - Commit</option>
                        <option value="Closed Won">Closed Won</option>
                        <option value="Closed Lost">Closed Lost</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="deal-column">
            <div class="field-row">
                <div class="field-label">Est. Close</div>
                <div class="field-input">
                    <input type="date" id="closeDate">
                </div>
            </div>
            <div class="field-row">
                <div class="field-label">Value (‚Ç¨)</div>
                <div class="field-input">
                    <input type="number" id="value" placeholder="Expected ARR / TCV">
                </div>
            </div>
        </div>
    </div>

    <!-- MEDDICC Health -->
    <div class="health-row">
        <strong>MEDDICC HEALTH (0‚Äì10):</strong>
        <div class="health-grid">
            <div class="health-item">
                <label>M (Metrics)</label>
                <input type="number" min="0" max="10" id="score-m">
            </div>
            <div class="health-item">
                <label>E (Econ. Buyer)</label>
                <input type="number" min="0" max="10" id="score-e">
            </div>
            <div class="health-item">
                <label>D (Dec. Criteria)</label>
                <input type="number" min="0" max="10" id="score-dc">
            </div>
            <div class="health-item">
                <label>D (Dec. Process)</label>
                <input type="number" min="0" max="10" id="score-dp">
            </div>
            <div class="health-item">
                <label>I (Pain)</label>
                <input type="number" min="0" max="10" id="score-i">
            </div>
            <div class="health-item">
                <label>C (Champion)</label>
                <input type="number" min="0" max="10" id="score-c">
            </div>
            <div class="health-item">
                <label>C (Competition)</label>
                <input type="number" min="0" max="10" id="score-comp">
            </div>
            <div class="health-item">
                <label>Overall</label>
                <input type="number" min="0" max="10" id="score-overall">
            </div>
        </div>
    </div>

    <!-- MEDDICC Grid -->
    <div class="meddicc-grid">
        <!-- M - Metrics -->
        <div class="meddicc-card">
            <div class="meddicc-header">
                <div class="meddicc-letter">M</div>
                <div>
                    <div class="meddicc-title">Metrics</div>
                    <div class="meddicc-sub">What measurable outcomes justify this purchase?</div>
                </div>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Business Metric(s)</div>
                <textarea id="m-metrics" placeholder="e.g. ARR growth, churn reduction, cost savings..."></textarea>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Baseline vs Target</div>
                <textarea id="m-baseline-target" placeholder="Where are they today vs target?"></textarea>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Estimated Impact (‚Ç¨ / %)</div>
                <input type="text" id="m-impact" placeholder="e.g. ‚Ç¨450k annual savings, +3% NRR">
            </div>
        </div>

        <!-- E - Economic Buyer -->
        <div class="meddicc-card">
            <div class="meddicc-header">
                <div class="meddicc-letter">E</div>
                <div>
                    <div class="meddicc-title">Economic Buyer</div>
                    <div class="meddicc-sub">Who owns the budget & final yes/no?</div>
                </div>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Name / Title</div>
                <input type="text" id="e-name" placeholder="e.g. Sarah Chen, CFO">
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Access</div>
                <select id="e-access">
                    <option value="">Select access level</option>
                    <option value="None">None</option>
                    <option value="Indirect">Indirect</option>
                    <option value="Direct">Direct</option>
                </select>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Alignment & Next Step</div>
                <textarea id="e-alignment" placeholder="How aligned are they? What is the next step with them?"></textarea>
            </div>
        </div>

        <!-- D - Decision Criteria -->
        <div class="meddicc-card">
            <div class="meddicc-header">
                <div class="meddicc-letter">D</div>
                <div>
                    <div class="meddicc-title">Decision Criteria</div>
                    <div class="meddicc-sub">How will they decide between options?</div>
                </div>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Decision Criteria</div>
                <textarea id="dc-criteria" placeholder="List technical, commercial and strategic criteria..."></textarea>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Our Fit vs Criteria</div>
                <textarea id="dc-fit" placeholder="Where are we strong / weak vs the criteria?"></textarea>
            </div>
        </div>

        <!-- D - Decision Process -->
        <div class="meddicc-card">
            <div class="meddicc-header">
                <div class="meddicc-letter">D</div>
                <div>
                    <div class="meddicc-title">Decision Process</div>
                    <div class="meddicc-sub">What steps, who is involved, and when?</div>
                </div>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Process Steps</div>
                <textarea id="dp-steps" placeholder="Describe evaluation steps, approvals, sign-off..."></textarea>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Key Dates / Milestones</div>
                <textarea id="dp-dates" placeholder="Pilot end, exec review, procurement, board meeting, etc."></textarea>
            </div>
        </div>

        <!-- I - Identify Pain -->
        <div class="meddicc-card">
            <div class="meddicc-header">
                <div class="meddicc-letter">I</div>
                <div>
                    <div class="meddicc-title">Identify Pain</div>
                    <div class="meddicc-sub">What problem are we solving, and for whom?</div>
                </div>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Business Pain(s)</div>
                <textarea id="i-pain" placeholder="e.g. rising costs, missed SLAs, churn, compliance risk..."></textarea>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Consequences of No Decision</div>
                <textarea id="i-consequence" placeholder="What happens if they do nothing?"></textarea>
            </div>
        </div>

        <!-- C - Champion -->
        <div class="meddicc-card">
            <div class="meddicc-header">
                <div class="meddicc-letter">C</div>
                <div>
                    <div class="meddicc-title">Champion</div>
                    <div class="meddicc-sub">Who sells internally when we are not in the room?</div>
                </div>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Name / Title</div>
                <input type="text" id="c-name" placeholder="e.g. VP of Ops, Head of IT">
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Strength & Influence</div>
                <textarea id="c-strength" placeholder="How strong is the champion? What proof do we have?"></textarea>
            </div>
        </div>

        <!-- C - Competition -->
        <div class="meddicc-card">
            <div class="meddicc-header">
                <div class="meddicc-letter">C</div>
                <div>
                    <div class="meddicc-title">Competition</div>
                    <div class="meddicc-sub">Who else is in the deal and how do we win?</div>
                </div>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Competitors</div>
                <textarea id="comp-list" placeholder="List known competitors and status..."></textarea>
            </div>
            <div class="meddicc-field">
                <div class="meddicc-label">Their Strengths vs Ours</div>
                <textarea id="comp-strengths" placeholder="Where are they perceived as strong? Where do we differentiate?"></textarea>
            </div>
        </div>
    </div>

    <!-- Bottom Section -->
    <div class="bottom-section">
        <div class="bottom-box">
            <div class="bottom-header">SUMMARY & GAPS</div>
            <div class="bottom-content">
                <textarea id="summary" placeholder="Summarise deal health and key MEDDICC gaps..."></textarea>
            </div>
        </div>
        <div class="bottom-box">
            <div class="bottom-header">RISKS & RED FLAGS</div>
            <div class="bottom-content">
                <textarea id="risks" placeholder="List key risks, red flags, and unknowns..."></textarea>
            </div>
        </div>
        <div class="bottom-box">
            <div class="bottom-header">ACTION PLAN</div>
            <div class="bottom-content">
                <table class="action-table">
                    <thead>
                        <tr>
                            <th>WHAT</th>
                            <th>WHO</th>
                            <th>WHEN</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="actionTableBody"></tbody>
                </table>
                <button class="add-row-btn" onclick="addActionRow()">+ Add Action</button>

                <div style="margin-top: 16px;">
                    <strong style="font-size: 0.75rem;">INFORMATION NEEDED</strong>
                    <table class="action-table" style="margin-top: 5px;">
                        <thead>
                            <tr>
                                <th>FROM WHOM</th>
                                <th>WHEN</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="infoTableBody"></tbody>
                    </table>
                    <button class="add-row-btn" onclick="addInfoRow()">+ Add Info Need</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- If you're still using PPTX, keep or adjust this (local vs CDN as discussed earlier) -->
<script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.11.1/dist/pptxgen.bundle.js"></script>

<script>
    let deals = {};
    let currentDealId = null;

    function loadFromStorage() {
        const saved = localStorage.getItem('meddiccDeals');
        if (saved) deals = JSON.parse(saved);
    }

    function saveToStorage() {
        localStorage.setItem('meddiccDeals', JSON.stringify(deals));
        document.getElementById('save-indicator').innerHTML = '‚úì Saved';
    }

    function createEmptyDeal(name) {
        return {
            id: 'deal-' + Date.now(),
            label: name || 'New Deal',
            data: {
                account: '',
                opportunity: '',
                owner: '',
                stage: '',
                closeDate: '',
                value: '',
                scores: { m: '', e: '', dc: '', dp: '', i: '', c: '', comp: '', overall: '' },
                mMetrics: '',
                mBaselineTarget: '',
                mImpact: '',
                eName: '',
                eAccess: '',
                eAlignment: '',
                dcCriteria: '',
                dcFit: '',
                dpSteps: '',
                dpDates: '',
                iPain: '',
                iConsequence: '',
                cName: '',
                cStrength: '',
                compList: '',
                compStrengths: '',
                summary: '',
                risks: '',
                actions: [],
                infoNeeds: []
            }
        };
    }

    function createSampleDeal() {
        const sample = createEmptyDeal('Sample Deal');
        sample.data.account = 'Globex Bank plc';
        sample.data.opportunity = 'Core Banking & Digital Channels Modernisation';
        sample.data.owner = 'Martin Brennan';
        sample.data.stage = '4 - Proposal';
        sample.data.closeDate = '2025-06-28';
        sample.data.value = '850000';
        sample.data.scores = {
            m: '9', e: '8', dc: '8', dp: '7', i: '9', c: '8', comp: '6', overall: '8'
        };
        sample.data.mMetrics = 'Reduce manual processing time, increase self-service, improve NPS.';
        sample.data.mBaselineTarget = '45 mins ‚Üí 15 mins per application; 32% ‚Üí 60% self-service; churn 10% ‚Üí 6%.';
        sample.data.mImpact = 'Est. ‚Ç¨1.3M FTE savings + ‚Ç¨900k ARR uplift + ‚Ç¨250k system savings.';
        sample.data.eName = 'Laura McKenzie, COO';
        sample.data.eAccess = 'Direct';
        sample.data.eAlignment = 'Strong sponsor, wants clear implementation risk management.';
        sample.data.dcCriteria = 'Compliance, integrations, time-to-value, TCO, references.';
        sample.data.dcFit = 'Strong on integrations & references, slightly higher PS cost.';
        sample.data.dpSteps = 'Digital/ops review, security, CFO/COO review, steering committee, procurement, sign-off.';
        sample.data.dpDates = 'Security by May 10; steering committee June 10; target close June 28.';
        sample.data.iPain = 'High manual workload, poor digital CX, slow product launch, negative NPS.';
        sample.data.iConsequence = '‚Ç¨2.5M+ ARR risk and increased operational cost if no change.';
        sample.data.cName = 'Daniel O‚ÄôNeill, Head of Digital Channels';
        sample.data.cStrength = 'High influence, drives RFP, close to COO/CIO.';
        sample.data.compList = 'Incumbent core vendor; digital-only challenger platform.';
        sample.data.compStrengths = 'Incumbent: low perceived risk, strong relationship. Challenger: strong UX, cheaper, fewer refs. We win on full platform, integrations, references.';
        sample.data.summary = 'Strong MEDDICC deal; need to firm decision process dates and deepen CFO sponsorship.';
        sample.data.risks = 'Incumbent discounting; steering committee could cut scope; procurement could commoditise.';
        sample.data.actions = [
            { what: 'Run exec value workshop with COO & CFO', who: 'AE', when: '2025-05-20' },
            { what: 'Complete security deep-dive and risk plan', who: 'Solution Architect', when: '2025-05-10' }
        ];
        sample.data.infoNeeds = [
            { from: 'Finance ‚Äì confirm baseline cost assumptions', when: '2025-05-15' },
            { from: 'Procurement ‚Äì clarify evaluation weighting', when: '2025-05-22' }
        ];
        return sample;
    }

    function loadSampleDeal() {
        const sample = createSampleDeal();
        deals[sample.id] = sample;
        currentDealId = sample.id;
        saveToStorage();
        renderDealSelector();
        loadDeal(sample.id);
        alert('Sample deal loaded!');
    }

    function initializeDeals() {
        loadFromStorage();
        if (Object.keys(deals).length === 0) {
            const first = createEmptyDeal('New Deal');
            deals[first.id] = first;
            currentDealId = first.id;
            saveToStorage();
        } else {
            currentDealId = Object.keys(deals)[0];
        }
        renderDealSelector();
        loadDeal(currentDealId);
    }

    function renderDealSelector() {
        const select = document.getElementById('deal-select');
        select.innerHTML = Object.entries(deals).map(([id, d]) =>
            `<option value="${id}" ${id === currentDealId ? 'selected' : ''}>
                ${d.label} - ${d.data.account || 'Untitled'}
            </option>`
        ).join('');
    }

    function createNewDeal() {
        const name = prompt('Enter deal label (e.g. Account - Opportunity):');
        if (!name) return;
        const newDeal = createEmptyDeal(name);
        deals[newDeal.id] = newDeal;
        currentDealId = newDeal.id;
        renderDealSelector();
        loadDeal(newDeal.id);
        saveToStorage();
    }

    function switchDeal(id) {
        saveCurrentDeal();
        currentDealId = id;
        loadDeal(id);
    }

    function saveCurrentDeal() {
        if (!currentDealId) return;
        const d = deals[currentDealId];

        d.data.account = document.getElementById('account').value;
        d.data.opportunity = document.getElementById('opportunity').value;
        d.data.owner = document.getElementById('owner').value;
        d.data.stage = document.getElementById('stage').value;
        d.data.closeDate = document.getElementById('closeDate').value;
        d.data.value = document.getElementById('value').value;

        d.data.scores = {
            m: document.getElementById('score-m').value,
            e: document.getElementById('score-e').value,
            dc: document.getElementById('score-dc').value,
            dp: document.getElementById('score-dp').value,
            i: document.getElementById('score-i').value,
            c: document.getElementById('score-c').value,
            comp: document.getElementById('score-comp').value,
            overall: document.getElementById('score-overall').value
        };

        d.data.mMetrics = document.getElementById('m-metrics').value;
        d.data.mBaselineTarget = document.getElementById('m-baseline-target').value;
        d.data.mImpact = document.getElementById('m-impact').value;

        d.data.eName = document.getElementById('e-name').value;
        d.data.eAccess = document.getElementById('e-access').value;
        d.data.eAlignment = document.getElementById('e-alignment').value;

        d.data.dcCriteria = document.getElementById('dc-criteria').value;
        d.data.dcFit = document.getElementById('dc-fit').value;

        d.data.dpSteps = document.getElementById('dp-steps').value;
        d.data.dpDates = document.getElementById('dp-dates').value;

        d.data.iPain = document.getElementById('i-pain').value;
        d.data.iConsequence = document.getElementById('i-consequence').value;

        d.data.cName = document.getElementById('c-name').value;
        d.data.cStrength = document.getElementById('c-strength').value;

        d.data.compList = document.getElementById('comp-list').value;
        d.data.compStrengths = document.getElementById('comp-strengths').value;

        d.data.summary = document.getElementById('summary').value;
        d.data.risks = document.getElementById('risks').value;

        // Actions
        d.data.actions = [];
        document.querySelectorAll('#actionTableBody tr').forEach(row => {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 3) {
                d.data.actions.push({
                    what: cells[0].querySelector('input').value,
                    who: cells[1].querySelector('input').value,
                    when: cells[2].querySelector('input').value
                });
            }
        });

        // Info needs
        d.data.infoNeeds = [];
        document.querySelectorAll('#infoTableBody tr').forEach(row => {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 2) {
                d.data.infoNeeds.push({
                    from: cells[0].querySelector('input').value,
                    when: cells[1].querySelector('input').value
                });
            }
        });
    }

    function loadDeal(id) {
        const d = deals[id];

        document.getElementById('account').value = d.data.account || '';
        document.getElementById('opportunity').value = d.data.opportunity || '';
        document.getElementById('owner').value = d.data.owner || '';
        document.getElementById('stage').value = d.data.stage || '';
        document.getElementById('closeDate').value = d.data.closeDate || '';
        document.getElementById('value').value = d.data.value || '';

        document.getElementById('score-m').value = d.data.scores.m || '';
        document.getElementById('score-e').value = d.data.scores.e || '';
        document.getElementById('score-dc').value = d.data.scores.dc || '';
        document.getElementById('score-dp').value = d.data.scores.dp || '';
        document.getElementById('score-i').value = d.data.scores.i || '';
        document.getElementById('score-c').value = d.data.scores.c || '';
        document.getElementById('score-comp').value = d.data.scores.comp || '';
        document.getElementById('score-overall').value = d.data.scores.overall || '';

        document.getElementById('m-metrics').value = d.data.mMetrics || '';
        document.getElementById('m-baseline-target').value = d.data.mBaselineTarget || '';
        document.getElementById('m-impact').value = d.data.mImpact || '';

        document.getElementById('e-name').value = d.data.eName || '';
        document.getElementById('e-access').value = d.data.eAccess || '';
        document.getElementById('e-alignment').value = d.data.eAlignment || '';

        document.getElementById('dc-criteria').value = d.data.dcCriteria || '';
        document.getElementById('dc-fit').value = d.data.dcFit || '';

        document.getElementById('dp-steps').value = d.data.dpSteps || '';
        document.getElementById('dp-dates').value = d.data.dpDates || '';

        document.getElementById('i-pain').value = d.data.iPain || '';
        document.getElementById('i-consequence').value = d.data.iConsequence || '';

        document.getElementById('c-name').value = d.data.cName || '';
        document.getElementById('c-strength').value = d.data.cStrength || '';

        document.getElementById('comp-list').value = d.data.compList || '';
        document.getElementById('comp-strengths').value = d.data.compStrengths || '';

        document.getElementById('summary').value = d.data.summary || '';
        document.getElementById('risks').value = d.data.risks || '';

        // Actions
        const actionBody = document.getElementById('actionTableBody');
        actionBody.innerHTML = '';
        if (d.data.actions && d.data.actions.length > 0) {
            d.data.actions.forEach(a => {
                const row = actionBody.insertRow();
                row.innerHTML = `
                    <td><input type="text" value="${a.what || ''}" placeholder="Action"></td>
                    <td><input type="text" value="${a.who || ''}" placeholder="Owner"></td>
                    <td><input type="date" value="${a.when || ''}"></td>
                    <td><button class="delete-row-btn" onclick="this.closest('tr').remove()">√ó</button></td>
                `;
            });
        }

        // Info needs
        const infoBody = document.getElementById('infoTableBody');
        infoBody.innerHTML = '';
        if (d.data.infoNeeds && d.data.infoNeeds.length > 0) {
            d.data.infoNeeds.forEach(i => {
                const row = infoBody.insertRow();
                row.innerHTML = `
                    <td><input type="text" value="${i.from || ''}" placeholder="Info needed from whom?"></td>
                    <td><input type="date" value="${i.when || ''}"></td>
                    <td><button class="delete-row-btn" onclick="this.closest('tr').remove()">√ó</button></td>
                `;
            });
        }
    }

    function addActionRow() {
        const tbody = document.getElementById('actionTableBody');
        const row = tbody.insertRow();
        row.innerHTML = `
            <td><input type="text" placeholder="Action"></td>
            <td><input type="text" placeholder="Owner"></td>
            <td><input type="date"></td>
            <td><button class="delete-row-btn" onclick="this.closest('tr').remove()">√ó</button></td>
        `;
    }

    function addInfoRow() {
        const tbody = document.getElementById('infoTableBody');
        const row = tbody.insertRow();
        row.innerHTML = `
            <td><input type="text" placeholder="Info needed from whom?"></td>
            <td><input type="date"></td>
            <td><button class="delete-row-btn" onclick="this.closest('tr').remove()">√ó</button></td>
        `;
    }

    function manualSave() {
        saveCurrentDeal();
        saveToStorage();
        alert('Saved!');
    }

    function exportToPDF() {
        saveCurrentDeal();
        window.print();
    }

    // Basic PPT export stub (keep or replace with your full version)
    function exportToPPT() {
        if (typeof PptxGenJS === 'undefined') {
            alert('PptxGenJS not loaded (CDN blocked / offline).');
            return;
        }
        saveCurrentDeal();
        const d = deals[currentDealId].data;
        const pptx = new PptxGenJS();
        const slide = pptx.addSlide();
        slide.addText('MEDDICC Deal Review', { x:0.5, y:0.5, fontSize:28, bold:true });
        slide.addText(`Account: ${d.account}\nOpportunity: ${d.opportunity}\nOwner: ${d.owner}`, { x:0.5, y:1.5, fontSize:14 });
        pptx.writeFile({ fileName: `MEDDICC_${(d.account || 'Deal').replace(/[^a-z0-9]+/gi,'_')}.pptx` });
    }

    // THEME TOGGLE
    function toggleTheme() {
        document.body.classList.toggle('light-theme');
        const theme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
        localStorage.setItem('meddiccTheme', theme);
    }

    document.addEventListener('input', function () {
        clearTimeout(window.saveTimer);
        window.saveTimer = setTimeout(() => {
            saveCurrentDeal();
            saveToStorage();
        }, 2000);
    });

    window.addEventListener('beforeunload', function () {
        saveCurrentDeal();
        saveToStorage();
    });

    document.addEventListener('DOMContentLoaded', function () {
        // restore theme
        const savedTheme = localStorage.getItem('meddiccTheme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-theme');
        }
        initializeDeals();
    });
</script>
</body>
</html>
