<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Coaching Tracker</title>
    <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: radial-gradient(circle at 0% 0%, #1f2937 0%, #020617 45%, #020617 100%);
        color: #e5e7eb;
        padding: 20px;
        min-height: 100vh;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    /* Top nav buttons ‚Äì match Sales Trigger System style */
    .controls {
        max-width: 1200px;
        margin: 0 auto 24px auto;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .btn {
        padding: 10px 22px;
        border-radius: 9999px;
        border: 1px solid #1f2937;
        background: linear-gradient(135deg, #020617 0%, #020617 100%);
        color: #e5e7eb;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.5);
        transition: all 0.2s ease;
    }

    .btn:hover {
        border-color: #38bdf8;
        box-shadow: 0 16px 40px rgba(15, 23, 42, 0.8);
        transform: translateY(-1px);
    }

    .btn:active {
        transform: translateY(0);
        box-shadow: 0 6px 18px rgba(15, 23, 42, 0.7);
    }

    header {
        text-align: center;
        color: #e5e7eb;
        margin-bottom: 30px;
    }

    h1 {
        font-size: 2.4rem;
        margin-bottom: 8px;
        display: inline-flex;
        align-items: center;
        gap: 10px;
    }

    .subtitle {
        font-size: 1rem;
        opacity: 0.8;
    }

    /* Glassy card containers */

    .session-controls,
    .tracker-card,
    .modal {
        background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.12) 0, rgba(15, 23, 42, 0.98) 40%);
        border-radius: 16px;
        padding: 20px 22px;
        margin-bottom: 20px;
        box-shadow:
            0 18px 45px rgba(15, 23, 42, 0.9),
            0 0 0 1px rgba(148, 163, 184, 0.06);
        border: 1px solid rgba(148, 163, 184, 0.25);
        backdrop-filter: blur(18px);
    }

    .session-controls {
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }

    .session-selector {
        flex: 1;
        min-width: 260px;
    }

    .session-selector label {
        display: block;
        font-weight: 600;
        color: #e5e7eb;
        margin-bottom: 8px;
        opacity: 0.9;
    }

    .session-selector select {
        width: 100%;
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid #1f2937;
        background: #020617;
        color: #e5e7eb;
        font-size: 0.95rem;
        outline: none;
        cursor: pointer;
        appearance: none;
    }

    .session-selector select:focus {
        border-color: #38bdf8;
        box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5);
    }

    .session-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .save-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #9ca3af;
        font-size: 0.85rem;
    }

    .session-info {
        background: rgba(15, 23, 42, 0.85);
        padding: 14px 16px;
        border-radius: 10px;
        border-left: 3px solid #38bdf8;
    }

    .session-date {
        font-size: 1.1rem;
        font-weight: 600;
        color: #e5e7eb;
        margin-bottom: 4px;
    }

    .session-meta {
        font-size: 0.85rem;
        color: #9ca3af;
    }

    /* Primary/secondary action buttons */

    .new-session-btn {
        padding: 10px 18px;
        border-radius: 9999px;
        border: none;
        background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        color: #022c22;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 600;
        box-shadow: 0 14px 40px rgba(22, 163, 74, 0.7);
        transition: all 0.2s ease;
    }

    .new-session-btn:hover {
        background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        transform: translateY(-1px);
    }

    .delete-session-btn-main,
    .copy-session-btn,
    .carryforward-session-btn {
        padding: 10px 18px;
        border-radius: 9999px;
        border: none;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .copy-session-btn {
        background: linear-gradient(135deg, #1d4ed8, #1e40af);
        color: #e5e7eb;
        box-shadow: 0 10px 30px rgba(37, 99, 235, 0.7);
    }

    .carryforward-session-btn {
        background: linear-gradient(135deg, #a855f7, #7c3aed);
        color: #f9fafb;
        box-shadow: 0 10px 30px rgba(168, 85, 247, 0.7);
    }

    .delete-session-btn-main {
        background: linear-gradient(135deg, #ef4444, #b91c1c);
        color: #fee2e2;
        box-shadow: 0 10px 30px rgba(239, 68, 68, 0.7);
    }

    .copy-session-btn:hover,
    .carryforward-session-btn:hover,
    .delete-session-btn-main:hover {
        transform: translateY(-1px);
        opacity: 0.95;
    }

    /* Export / analytics bar */

    .export-analytics-bar {
        background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.18) 0, rgba(15, 23, 42, 0.98) 40%);
        border-radius: 16px;
        padding: 14px 18px;
        margin-bottom: 20px;
        box-shadow:
            0 18px 45px rgba(15, 23, 42, 0.9),
            0 0 0 1px rgba(148, 163, 184, 0.06);
        border: 1px solid rgba(148, 163, 184, 0.25);
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    /* Use this class on that white div you have before */
    .export-analytics-bar button {
        border-radius: 9999px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    /* Section headers */

    .tracker-card {
        margin-bottom: 24px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 18px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .section-title {
        font-size: 1.2rem;
        color: #e5e7eb;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
    }

    .add-item-btn {
        padding: 8px 16px;
        border-radius: 9999px;
        border: none;
        background: linear-gradient(135deg, #1d4ed8, #1e40af);
        color: #e5e7eb;
        cursor: pointer;
        font-size: 0.85rem;
        font-weight: 500;
        box-shadow: 0 12px 30px rgba(37, 99, 235, 0.6);
        transition: all 0.2s ease;
    }

    .add-item-btn:hover {
        transform: translateY(-1px);
    }

    .items-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .item {
        background: rgba(15, 23, 42, 0.85);
        padding: 14px 12px;
        border-radius: 10px;
        border-left: 3px solid #38bdf8;
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }

    .item-checkbox {
        margin-top: 3px;
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: #22c55e;
    }

    .item-status-buttons {
        display: flex;
        gap: 8px;
        margin-top: 2px;
    }

    .status-btn {
        padding: 4px 10px;
        border-radius: 9999px;
        border: 1px solid transparent;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        background: transparent;
        color: #e5e7eb;
        transition: all 0.2s ease;
    }

    .status-btn.hit {
        border-color: #22c55e;
        color: #22c55e;
    }

    .status-btn.hit.active {
        background: #22c55e;
        color: #022c22;
    }

    .status-btn.miss {
        border-color: #ef4444;
        color: #fca5a5;
    }

    .status-btn.miss.active {
        background: #ef4444;
        color: #fee2e2;
    }

    .item-content {
        flex: 1;
    }

    .item-text {
        outline: none;
        min-height: 24px;
        padding: 4px;
        border-radius: 4px;
        cursor: text;
        color: #e5e7eb;
    }

    .item-text:hover {
        background: rgba(15, 23, 42, 0.8);
    }

    .item-text:focus {
        background: rgba(15, 23, 42, 0.95);
        box-shadow: 0 0 0 1px #38bdf8;
    }

    .item-text[contenteditable="true"]:empty:before {
        content: "Click to add details...";
        color: #6b7280;
        font-style: italic;
    }

    .item-completed {
        text-decoration: line-through;
        opacity: 0.5;
    }

    .delete-item-btn {
        padding: 6px 12px;
        border-radius: 9999px;
        border: none;
        background: rgba(239, 68, 68, 0.08);
        color: #fecaca;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .delete-item-btn:hover {
        background: #ef4444;
        color: #fee2e2;
    }

    /* Progress / stats */

    .progress-tracker {
        background: rgba(15, 23, 42, 0.85);
        border-radius: 12px;
        padding: 14px 14px 16px;
        border: 1px solid #1f2937;
        margin-top: 6px;
    }

    .goal-input-section {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 12px;
        padding: 10px;
        background: rgba(15, 23, 42, 0.9);
        border-radius: 10px;
    }

    .goal-input-label {
        font-weight: 600;
        color: #e5e7eb;
        white-space: nowrap;
        font-size: 0.85rem;
    }

    .goal-input {
        flex: 1;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #1f2937;
        background: #020617;
        color: #e5e7eb;
        font-size: 0.9rem;
        outline: none;
    }

    .goal-input:focus {
        border-color: #38bdf8;
        box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
    }

    .update-goal-btn {
        padding: 8px 18px;
        border-radius: 9999px;
        border: none;
        background: linear-gradient(135deg, #0ea5e9, #0369a1);
        color: #e0f2fe;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
    }

    .progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .progress-title {
        font-weight: 600;
        color: #bae6fd;
        font-size: 0.95rem;
    }

    .progress-percentage {
        font-size: 1.4rem;
        font-weight: 700;
    }

    .progress-bar-container {
        background: #020617;
        border-radius: 9999px;
        height: 26px;
        overflow: hidden;
        margin-bottom: 10px;
    }

    .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #f9fafb;
        font-weight: 600;
        font-size: 0.85rem;
        transition: width 0.4s ease;
    }

    .progress-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin-top: 8px;
    }

    .stat-box {
        background: rgba(15, 23, 42, 0.9);
        padding: 10px;
        border-radius: 10px;
        text-align: center;
        border: 1px solid #111827;
    }

    .stat-value {
        font-size: 1.2rem;
        font-weight: 700;
        color: #e5e7eb;
    }

    .stat-label {
        font-size: 0.8rem;
        color: #9ca3af;
        margin-top: 2px;
    }

    .item-progress-section {
        margin-top: 10px;
        width: 100%;
    }

    .item-progress-inputs {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-bottom: 6px;
        flex-wrap: wrap;
    }

    .item-progress-label {
        font-size: 0.8rem;
        color: #9ca3af;
        font-weight: 600;
    }

    .item-progress-input {
        width: 80px;
        padding: 6px 8px;
        border-radius: 8px;
        border: 1px solid #1f2937;
        background: #020617;
        color: #e5e7eb;
        font-size: 0.85rem;
        outline: none;
    }

    .update-progress-btn {
        padding: 6px 12px;
        border-radius: 9999px;
        border: none;
        background: linear-gradient(135deg, #0ea5e9, #0369a1);
        color: #e0f2fe;
        font-size: 0.8rem;
        cursor: pointer;
    }

    .item-progress-bar-container {
        background: #020617;
        border-radius: 9999px;
        height: 20px;
        overflow: hidden;
    }

    .item-progress-bar-fill {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 600;
        color: #f9fafb;
    }

    /* Textareas */

    .textarea-large {
        width: 100%;
        min-height: 120px;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid #1f2937;
        background: #020617;
        color: #e5e7eb;
        font-family: inherit;
        font-size: 0.95rem;
        resize: vertical;
        outline: none;
    }

    .textarea-large:focus {
        border-color: #38bdf8;
        box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5);
    }

    .add-section-btn {
        padding: 12px 24px;
        border-radius: 9999px;
        border: none;
        width: 100%;
        background: linear-gradient(135deg, #22c55e, #16a34a);
        color: #022c22;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 600;
        box-shadow: 0 16px 40px rgba(22, 163, 74, 0.7);
    }

    .section-title-editable {
        border: none;
        background: transparent;
        font-size: 1.2rem;
        font-weight: 600;
        color: #e5e7eb;
        outline: none;
    }

    .delete-section-btn {
        padding: 6px 12px;
        border-radius: 9999px;
        border: none;
        background: rgba(239, 68, 68, 0.12);
        color: #fecaca;
        font-size: 0.8rem;
        cursor: pointer;
    }

    .empty-state {
        text-align: center;
        color: #6b7280;
        padding: 24px;
        font-style: italic;
    }

    /* Action plan */

    .action-plan-item {
        background: rgba(15, 23, 42, 0.9);
        padding: 18px 16px;
        border-radius: 12px;
        border-left: 3px solid #38bdf8;
        margin-bottom: 12px;
    }

    .action-plan-row {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 14px;
        margin-bottom: 10px;
    }

    .action-plan-field {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .action-plan-label {
        font-size: 0.8rem;
        font-weight: 600;
        color: #9ca3af;
    }

    .action-plan-input,
    .action-plan-select,
    .action-plan-textarea {
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #1f2937;
        background: #020617;
        color: #e5e7eb;
        font-size: 0.9rem;
        font-family: inherit;
        outline: none;
    }

    .action-plan-select {
        cursor: pointer;
    }

    .action-plan-input:focus,
    .action-plan-select:focus,
    .action-plan-textarea:focus {
        border-color: #38bdf8;
        box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5);
    }

    /* Custom sections */

    .custom-section .section-header {
        gap: 10px;
        flex-wrap: wrap;
    }

    /* Modal */

    .modal-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.85);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .modal-overlay.active {
        display: flex;
    }

    .modal {
        max-width: 520px;
        width: 90%;
    }

    .modal-header {
        font-size: 1.4rem;
        font-weight: 600;
        color: #e5e7eb;
        margin-bottom: 16px;
    }

    .modal-body {
        margin-bottom: 16px;
        color: #e5e7eb;
    }

    .modal-checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .modal-checkbox-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        background: rgba(15, 23, 42, 0.9);
        border-radius: 10px;
        cursor: pointer;
        border: 1px solid #1f2937;
    }

    .modal-checkbox-item:hover {
        border-color: #38bdf8;
    }

    .modal-checkbox {
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: #22c55e;
    }

    .modal-checkbox-label {
        flex: 1;
        cursor: pointer;
        font-size: 0.9rem;
        color: #e5e7eb;
    }

    .modal-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 10px;
    }

    .modal-btn {
        padding: 8px 16px;
        border-radius: 9999px;
        border: none;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .modal-btn-primary {
        background: linear-gradient(135deg, #a855f7, #7c3aed);
        color: #f5f3ff;
    }

    .modal-btn-secondary {
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        border: 1px solid #4b5563;
    }

    @media (max-width: 768px) {
        .session-controls {
            flex-direction: column;
            align-items: stretch;
        }

        .action-plan-row {
            grid-template-columns: 1fr;
        }
    }
/* -------- THEME TOGGLE: LIGHT THEME OVERRIDES -------- */

body.light-theme {
    background: radial-gradient(circle at 0 0, #dbeafe 0%, #f9fafb 40%, #f9fafb 100%);
    color: #111827;
}

/* Cards & containers */
body.light-theme .session-controls,
body.light-theme .tracker-card,
body.light-theme .modal,
body.light-theme .export-analytics-bar {
    background: #ffffff;
    border-color: rgba(148, 163, 184, 0.4);
    box-shadow:
        0 10px 25px rgba(148, 163, 184, 0.35),
        0 0 0 1px rgba(209, 213, 219, 0.7);
}

/* Header text */
body.light-theme header,
body.light-theme .section-title,
body.light-theme .session-date {
    color: #111827;
}

body.light-theme .session-meta,
body.light-theme .stat-label,
body.light-theme .goal-input-label,
body.light-theme .item-progress-label,
body.light-theme .action-plan-label {
    color: #6b7280;
}

/* Session info bar */
body.light-theme .session-info {
    background: #eff6ff;
    border-left-color: #2563eb;
}

/* Buttons */
body.light-theme .btn {
    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
    color: #111827;
    border-color: #d1d5db;
}

body.light-theme .btn:hover {
    border-color: #2563eb;
}

/* Items */
body.light-theme .item {
    background: #f3f4f6;
    border-left-color: #2563eb;
}

/* Inputs */
body.light-theme .session-selector select,
body.light-theme .goal-input,
body.light-theme .item-progress-input,
body.light-theme .textarea-large,
body.light-theme .action-plan-input,
body.light-theme .action-plan-select,
body.light-theme .action-plan-textarea {
    background: #ffffff;
    color: #111827;
    border-color: #d1d5db;
}

body.light-theme .session-selector select:focus,
body.light-theme .goal-input:focus,
body.light-theme .item-progress-input:focus,
body.light-theme .textarea-large:focus,
body.light-theme .action-plan-input:focus,
body.light-theme .action-plan-select:focus,
body.light-theme .action-plan-textarea:focus {
    border-color: #2563eb;
    box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.4);
}

/* Text inside items */
body.light-theme .item-text {
    color: #111827;
}

/* Delete buttons */
body.light-theme .delete-item-btn,
body.light-theme .delete-section-btn {
    background: #fee2e2;
    color: #b91c1c;
}

body.light-theme .delete-item-btn:hover,
body.light-theme .delete-section-btn:hover {
    background: #ef4444;
    color: #fef2f2;
}

/* Action plan */
body.light-theme .action-plan-item {
    background: #f9fafb;
}

/* Modal */
body.light-theme .modal {
    background: #ffffff;
}

body.light-theme .modal-header {
    color: #111827;
}

body.light-theme .modal-checkbox-item {
    background: #f3f4f6;
    border-color: #e5e7eb;
}

body.light-theme .modal-checkbox-item:hover {
    border-color: #2563eb;
}

</style>

</head>
<body>

<<div class="controls">
  <button class="btn" onclick="window.location.href='Index.html'">Back to Index</button>


  <!-- Theme toggle button -->
  <button class="btn theme-toggle" id="theme-toggle-btn">üåô Dark Theme</button>

</div>
    <div class="container">
        <header>
            <h1>üìä Weekly Coaching Tracker</h1>
            <p class="subtitle">Track progress, set targets, and plan your coaching sessions - All data saved locally</p>
        </header>
        <div class="session-controls">
            <div class="session-selector">
                <label for="session-select">Select Coaching Session:</label>
                <select id="session-select" onchange="switchSession(this.value)"></select>
            </div>
            <div class="save-indicator">
                <span id="save-indicator">Auto-save enabled</span>
            </div>
            <div class="session-actions">
                <button class="new-session-btn" onclick="createNewSession()">+ New Session</button>
                <button class="carryforward-session-btn" onclick="showCarryForwardModal()">‚è≠Ô∏è Carry Forward</button>
                <button class="copy-session-btn" onclick="copyCurrentSession()">üìã Copy Session</button>
                <button class="delete-session-btn-main" onclick="deleteCurrentSession()">üóëÔ∏è Delete</button>
            </div>
        </div>
        <div style="background: white; border-radius: 12px; padding: 15px 20px; margin-bottom: 20px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); display: flex; gap: 10px; flex-wrap: wrap;">
            <button onclick="exportToPDF()" style="padding: 10px 20px; background: #e53e3e; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95em; font-weight: 500;">
                üìÑ Export to PDF
            </button>
            <button onclick="showAnalyticsModal()" style="padding: 10px 20px; background: #5a67d8; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95em; font-weight: 500;">
                üìà View Trends & Analytics
            </button>
        </div>
        <div class="tracker-card">
            <div class="session-info" id="session-info"></div>
        </div>
        <div id="tracker-content"></div>
        <button class="add-section-btn" onclick="addCustomSection()">+ Add Custom Section</button>
    </div>

    <!-- Carry Forward Modal -->
    <div class="modal-overlay" id="carryForwardModal">
        <div class="modal">
            <div class="modal-header">‚è≠Ô∏è Carry Forward to New Session</div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: #4a5568;">Select what you want to carry forward to the new session:</p>
                <div class="modal-checkbox-group">
                    <label class="modal-checkbox-item">
                        <input type="checkbox" class="modal-checkbox" id="carryforward-monthly-goal" checked>
                        <span class="modal-checkbox-label">
                            <strong>Monthly Goal Data</strong>
                            <br>
                            <small style="color: #718096;">Target and current progress values</small>
                        </span>
                    </label>
                    <label class="modal-checkbox-item">
                        <input type="checkbox" class="modal-checkbox" id="carryforward-weekly" checked>
                        <span class="modal-checkbox-label">
                            <strong>Previous Week's Targets</strong>
                            <br>
                            <small style="color: #718096;">All weekly targets (status will be reset)</small>
                        </span>
                    </label>
                    <label class="modal-checkbox-item">
                        <input type="checkbox" class="modal-checkbox" id="carryforward-action-plan">
                        <span class="modal-checkbox-label">
                            <strong>Incomplete Action Plan Items</strong>
                            <br>
                            <small style="color: #718096;">Only action plan items not yet completed</small>
                        </span>
                    </label>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" onclick="closeCarryForwardModal()">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="executeCarryForward()">Create Session</button>
            </div>
        </div>
    </div>

    <script>
let sessions = {};
let currentSessionId = null;
let autoSaveInterval = null;
let lastSaveTime = null;

const STORAGE_KEYS = {
    SESSIONS: 'coachingTracker_sessions',
    CURRENT_ID: 'coachingTracker_currentId'
};

function loadFromStorage() {
    try {
        const savedSessions = localStorage.getItem(STORAGE_KEYS.SESSIONS);
        const savedCurrentId = localStorage.getItem(STORAGE_KEYS.CURRENT_ID);
        
        if (savedSessions) {
            sessions = JSON.parse(savedSessions);
            console.log('‚úì Loaded sessions from localStorage');
        }
        if (savedCurrentId) {
            currentSessionId = savedCurrentId;
        }
    } catch (error) {
        console.error('Error loading from localStorage:', error);
        alert('Error loading saved data. Starting fresh.');
    }
}

function saveToStorage() {
    try {
        localStorage.setItem(STORAGE_KEYS.SESSIONS, JSON.stringify(sessions));
        localStorage.setItem(STORAGE_KEYS.CURRENT_ID, currentSessionId);
        lastSaveTime = new Date();
        updateSaveIndicator();
        console.log('‚úì Saved to localStorage');
    } catch (error) {
        console.error('Error saving to localStorage:', error);
        alert('Error saving data. Your changes may not be saved.');
    }
}

function autoSave() {
    saveCurrentSession();
    saveToStorage();
}

function startAutoSave() {
    if (autoSaveInterval) clearInterval(autoSaveInterval);
    autoSaveInterval = setInterval(autoSave, 30000);
}

function updateSaveIndicator() {
    const indicator = document.getElementById('save-indicator');
    if (indicator && lastSaveTime) {
        const timeStr = lastSaveTime.toLocaleTimeString();
        indicator.innerHTML = `‚úì Last saved: ${timeStr}`;
        indicator.style.color = '#48bb78';
        setTimeout(() => { indicator.style.color = '#a0aec0'; }, 2000);
    }
}

function initializeSessions() {
    loadFromStorage();
    
    if (Object.keys(sessions).length === 0) {
        const firstSessionId = 'session-' + Date.now();
        sessions[firstSessionId] = createEmptySession(new Date());
        currentSessionId = firstSessionId;
        saveToStorage();
    } else {
        Object.keys(sessions).forEach(sessionId => {
            if (!sessions[sessionId].data.monthlyGoal) {
                sessions[sessionId].data.monthlyGoal = { target: 100, current: 0 };
            }
            if (!sessions[sessionId].data.growSession) {
                sessions[sessionId].data.growSession = { goal: '', reality: '', options: '', wayforward: '' };
            }
            if (!sessions[sessionId].data.actionPlan) {
                sessions[sessionId].data.actionPlan = [];
            }
        });
    }
    renderSessionSelector();
    loadSession(currentSessionId);
    startAutoSave();
}

function createEmptySession(date) {
    return {
        date: date.toISOString(),
        dateFormatted: formatDate(date),
        created: new Date().toISOString(),
        data: {
            monthly: [],
            weekly: [],
            customSections: [],
            monthlyGoal: { target: 100, current: 0 },
            growSession: { goal: '', reality: '', options: '', wayforward: '' },
            actionPlan: []
        }
    };
}

function formatDate(date) {
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('en-US', options);
}

function createNewSession() {
    saveCurrentSession();
    
    const currentSession = sessions[currentSessionId];
    
    const dateInput = prompt('Enter session date (YYYY-MM-DD format, or leave blank for today):');
    let sessionDate;
    
    if (dateInput) {
        sessionDate = new Date(dateInput);
        if (isNaN(sessionDate.getTime())) {
            alert('Invalid date format. Using today\'s date.');
            sessionDate = new Date();
        }
    } else {
        sessionDate = new Date();
    }

    const sessionId = 'session-' + Date.now();
    const newSession = createEmptySession(sessionDate);
    
    // Automatically carry forward monthly goal data
    if (currentSession && currentSession.data.monthlyGoal) {
        newSession.data.monthlyGoal = {
            target: currentSession.data.monthlyGoal.target || 100,
            current: currentSession.data.monthlyGoal.current || 0
        };
    }
    
    // Automatically carry forward incomplete action plan items
    if (currentSession && currentSession.data.actionPlan) {
        newSession.data.actionPlan = currentSession.data.actionPlan
            .filter(item => item.status !== 'completed')
            .map(item => ({
                id: Date.now() + Math.random(),
                milestone: item.milestone || '',
                owner: item.owner || '',
                due: item.due || '',
                evidence: item.evidence || '',
                status: item.status || 'open',
                action: item.action || ''
            }));
    }
    
    // Carry forward weekly targets with reset status
    if (currentSession && currentSession.data.weekly && currentSession.data.weekly.length > 0) {
        newSession.data.weekly = currentSession.data.weekly.map(target => ({
            id: Date.now() + Math.random(),
            text: target.text || '',
            status: null,
            completed: false,
            progress: target.progress || 0,
            target: target.target || 100
        }));
    }
    
    sessions[sessionId] = newSession;
    currentSessionId = sessionId;
    
    renderSessionSelector();
    loadSession(sessionId);
    autoSave();
    
    const incompleteCount = newSession.data.actionPlan.length;
    if (incompleteCount > 0) {
        alert(`New session created! ${incompleteCount} incomplete action plan item(s) carried forward.`);
    } else {
        alert('New session created!');
    }
}

function showCarryForwardModal() {
    document.getElementById('carryForwardModal').classList.add('active');
}

function closeCarryForwardModal() {
    document.getElementById('carryForwardModal').classList.remove('active');
}

function executeCarryForward() {
    saveCurrentSession();
    
    const carryMonthlyGoal = document.getElementById('carryforward-monthly-goal').checked;
    const carryWeekly = document.getElementById('carryforward-weekly').checked;
    const carryActionPlan = document.getElementById('carryforward-action-plan').checked;
    
    const currentSession = sessions[currentSessionId];
    const newSessionId = 'session-' + Date.now();
    const newDate = new Date();
    const newSession = createEmptySession(newDate);
    
    // Carry forward monthly goal data
    if (carryMonthlyGoal && currentSession.data.monthlyGoal) {
        newSession.data.monthlyGoal = {
            target: currentSession.data.monthlyGoal.target || 100,
            current: currentSession.data.monthlyGoal.current || 0
        };
    }
    
    // Carry forward weekly targets (reset status)
    if (carryWeekly && currentSession.data.weekly) {
        newSession.data.weekly = currentSession.data.weekly.map(target => ({
            id: Date.now() + Math.random(),
            text: target.text || '',
            status: null,
            completed: false,
            progress: target.progress || 0,
            target: target.target || 100
        }));
    }
    
    // Carry forward incomplete action plan items only
    if (carryActionPlan && currentSession.data.actionPlan) {
        newSession.data.actionPlan = currentSession.data.actionPlan
            .filter(item => item.status !== 'completed')
            .map(item => ({
                id: Date.now() + Math.random(),
                milestone: item.milestone || '',
                owner: item.owner || '',
                due: item.due || '',
                evidence: item.evidence || '',
                status: item.status || 'open',
                action: item.action || ''
            }));
    }
    
    sessions[newSessionId] = newSession;
    currentSessionId = newSessionId;
    
    closeCarryForwardModal();
    renderSessionSelector();
    loadSession(newSessionId);
    saveToStorage();
    
    // Show success message
    const indicator = document.getElementById('save-indicator');
    indicator.innerHTML = '‚úì New session created with carried forward data!';
    indicator.style.color = '#48bb78';
    setTimeout(() => {
        updateSaveIndicator();
    }, 3000);
}

function copyCurrentSession() {
    const newSessionId = 'session-' + Date.now();
    const currentSession = sessions[currentSessionId];
    const copiedData = JSON.parse(JSON.stringify(currentSession.data));
    const newDate = new Date();
    sessions[newSessionId] = {
        date: newDate.toISOString(),
        dateFormatted: formatDate(newDate) + ' (Copy)',
        created: new Date().toISOString(),
        data: copiedData
    };
    currentSessionId = newSessionId;
    renderSessionSelector();
    loadSession(newSessionId);
    autoSave();
}

function switchSession(sessionId) {
    saveCurrentSession();
    currentSessionId = sessionId;
    loadSession(sessionId);
}

function deleteCurrentSession() {
    if (Object.keys(sessions).length === 1) {
        alert('Cannot delete the last session.');
        return;
    }
    if (confirm('Are you sure you want to delete this session?')) {
        delete sessions[currentSessionId];
        currentSessionId = Object.keys(sessions)[0];
        renderSessionSelector();
        loadSession(currentSessionId);
        autoSave();
    }
}

function renderSessionSelector() {
    const select = document.getElementById('session-select');
    const sortedSessions = Object.entries(sessions).sort((a, b) => {
        return new Date(b[1].date) - new Date(a[1].date);
    });
    select.innerHTML = sortedSessions.map(([id, session]) => 
        `<option value="${id}" ${id === currentSessionId ? 'selected' : ''}>${session.dateFormatted}</option>`
    ).join('');
}

function saveCurrentSession() {
    if (!currentSessionId) return;
    const session = sessions[currentSessionId];
    
    // Save GROW session fields
    const growGoal = document.getElementById('grow-goal');
    const growReality = document.getElementById('grow-reality');
    const growOptions = document.getElementById('grow-options');
    const growWayforward = document.getElementById('grow-wayforward');
    
    if (growGoal) session.data.growSession.goal = growGoal.value;
    if (growReality) session.data.growSession.reality = growReality.value;
    if (growOptions) session.data.growSession.options = growOptions.value;
    if (growWayforward) session.data.growSession.wayforward = growWayforward.value;
}

function loadSession(sessionId) {
    const session = sessions[sessionId];
    if (!session) return;
    const sessionInfo = document.getElementById('session-info');
    const createdDate = new Date(session.created);
    sessionInfo.innerHTML = `
        <div class="session-date">üìÖ ${session.dateFormatted}</div>
        <div class="session-meta">Created: ${formatDate(createdDate)} | Total Sessions: ${Object.keys(sessions).length}</div>
    `;
    renderTrackerContent();
}

function renderTrackerContent() {
    const content = document.getElementById('tracker-content');
    content.innerHTML = `
        <div class="tracker-card">
            <div class="section-header">
                <div class="section-title"><span>üéØ</span>Monthly Targets</div>
                <button class="add-item-btn" onclick="addItem('monthly')">+ Add Target</button>
            </div>
            <div class="progress-tracker">
                <div class="goal-input-section">
                    <span class="goal-input-label">Target:</span>
                    <input type="number" class="goal-input" id="monthly-target-input" placeholder="e.g., 100">
                    <span class="goal-input-label">Current:</span>
                    <input type="number" class="goal-input" id="monthly-current-input" placeholder="e.g., 45">
                    <button class="update-goal-btn" onclick="updateMonthlyGoal()">Update</button>
                </div>
                <div class="progress-header">
                    <div class="progress-title">üìä Monthly Progress</div>
                    <div class="progress-percentage" id="monthly-percentage">0%</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="monthly-progress-bar" style="width: 0%">
                        <span id="monthly-progress-text"></span>
                    </div>
                </div>
                <div class="progress-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="monthly-current-stat">0</div>
                        <div class="stat-label">Current</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="monthly-target-stat">100</div>
                        <div class="stat-label">Target</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="monthly-remaining-stat">100</div>
                        <div class="stat-label">Remaining</div>
                    </div>
                </div>
            </div>
            <div class="items-container" id="monthly-items"></div>
        </div>

        <div class="tracker-card">
            <div class="section-header">
                <div class="section-title"><span>üìÖ</span>Weekly Targets</div>
                <button class="add-item-btn" onclick="addItem('weekly')">+ Add Target</button>
            </div>
            <div class="items-container" id="weekly-items"></div>
        </div>

        <div class="tracker-card">
            <div class="section-header">
                <div class="section-title"><span>üå±</span>GROW - Session</div>
            </div>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <div>
                    <label style="display: block; font-weight: 600; color: #2d3748; margin-bottom: 8px;">G - Goal for Week</label>
                    <textarea class="textarea-large" id="grow-goal" placeholder="What do you want to achieve this week?" style="min-height: 80px;"></textarea>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #2d3748; margin-bottom: 8px;">R - Reality</label>
                    <textarea class="textarea-large" id="grow-reality" placeholder="What is the current situation?" style="min-height: 80px;"></textarea>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #2d3748; margin-bottom: 8px;">O - Options</label>
                    <textarea class="textarea-large" id="grow-options" placeholder="What options do you have?" style="min-height: 80px;"></textarea>
                </div>
                <div>
                    <label style="display: block; font-weight: 600; color: #2d3748; margin-bottom: 8px;">W - Way Forward</label>
                    <textarea class="textarea-large" id="grow-wayforward" placeholder="What will you do?" style="min-height: 80px;"></textarea>
                </div>
            </div>
        </div>

        <div class="tracker-card">
            <div class="section-header">
                <div class="section-title"><span>ü§ù</span>Mutual Action Plan</div>
                <button class="add-item-btn" onclick="addActionPlanItem()">+ Add Action</button>
            </div>
            <div class="items-container" id="action-plan-items"></div>
        </div>

        <div class="custom-sections" id="custom-sections"></div>
    `;
    
    const session = sessions[currentSessionId];
    if (session) {
        renderSection('monthly');
        renderSection('weekly');
        renderActionPlan();
        renderCustomSections();
        
        setTimeout(() => {
            renderMonthlyProgress();
        }, 100);
        
        setTimeout(() => {
            const growGoal = document.getElementById('grow-goal');
            const growReality = document.getElementById('grow-reality');
            const growOptions = document.getElementById('grow-options');
            const growWayforward = document.getElementById('grow-wayforward');
            
            if (growGoal) {
                growGoal.value = session.data.growSession.goal || '';
                growGoal.addEventListener('input', () => autoSave());
            }
            if (growReality) {
                growReality.value = session.data.growSession.reality || '';
                growReality.addEventListener('input', () => autoSave());
            }
            if (growOptions) {
                growOptions.value = session.data.growSession.options || '';
                growOptions.addEventListener('input', () => autoSave());
            }
            if (growWayforward) {
                growWayforward.value = session.data.growSession.wayforward || '';
                growWayforward.addEventListener('input', () => autoSave());
            }
        }, 0);
    }
}

function addItem(sectionId) {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    const item = {
        id: Date.now(),
        text: '',
        completed: false,
        status: null,
        progress: 0,
        target: 100
    };
    
    if (session.data[sectionId]) {
        session.data[sectionId].push(item);
    } else {
        const customSection = session.data.customSections.find(s => s.id === sectionId);
        if (customSection) customSection.items.push(item);
    }
    
    renderSection(sectionId);
    autoSave();
}

function addActionPlanItem() {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    const item = {
        id: Date.now(),
        milestone: '',
        owner: '',
        due: '',
        evidence: '',
        status: 'open',
        action: ''
    };
    
    session.data.actionPlan.push(item);
    renderActionPlan();
    autoSave();
}

function updateActionPlanItem(itemId, field, value) {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    const item = session.data.actionPlan.find(i => i.id === itemId);
    if (item) {
        item[field] = value;
        autoSave();
    }
}

function deleteActionPlanItem(itemId) {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    session.data.actionPlan = session.data.actionPlan.filter(i => i.id !== itemId);
    renderActionPlan();
    autoSave();
}

function renderActionPlan() {
    const container = document.getElementById('action-plan-items');
    if (!container) return;
    
    const session = sessions[currentSessionId];
    if (!session) return;
    
    const items = session.data.actionPlan || [];
    
    if (items.length === 0) {
        container.innerHTML = '<div class="empty-state">No action plan items added yet. Click "+ Add Action" to get started.</div>';
    } else {
        container.innerHTML = items.map(item => {
            const statusColor = {
                'open': '#3b82f6',
                'in progress': '#f97316',
                'delayed': '#ef4444',
                'completed': '#16a34a'
            }[item.status] || '#3b82f6';
            
            return `
                <div class="action-plan-item" style="border-left-color: ${statusColor};">
                    <div class="action-plan-row">
                        <div class="action-plan-field">
                            <label class="action-plan-label">Milestone</label>
                            <input type="text" class="action-plan-input" value="${item.milestone || ''}"
                                   onchange="updateActionPlanItem(${item.id}, 'milestone', this.value)"
                                   placeholder="e.g., Complete proposal draft">
                        </div>
                        <div class="action-plan-field">
                            <label class="action-plan-label">Owner</label>
                            <input type="text" class="action-plan-input" value="${item.owner || ''}"
                                   onchange="updateActionPlanItem(${item.id}, 'owner', this.value)"
                                   placeholder="e.g., John Smith">
                        </div>
                        <div class="action-plan-field">
                            <label class="action-plan-label">Due Date</label>
                            <input type="date" class="action-plan-input" value="${item.due || ''}"
                                   onchange="updateActionPlanItem(${item.id}, 'due', this.value)">
                        </div>
                    </div>
                    <div class="action-plan-row">
                        <div class="action-plan-field">
                            <label class="action-plan-label">Evidence</label>
                            <input type="text" class="action-plan-input" value="${item.evidence || ''}"
                                   onchange="updateActionPlanItem(${item.id}, 'evidence', this.value)"
                                   placeholder="e.g., Signed document, Email confirmation">
                        </div>
                        <div class="action-plan-field">
                            <label class="action-plan-label">Status</label>
                            <select class="action-plan-select" 
                                    onchange="updateActionPlanItem(${item.id}, 'status', this.value)">
                                <option value="open" ${item.status === 'open' ? 'selected' : ''}>Open</option>
                                <option value="in progress" ${item.status === 'in progress' ? 'selected' : ''}>In Progress</option>
                                <option value="delayed" ${item.status === 'delayed' ? 'selected' : ''}>Delayed</option>
                                <option value="completed" ${item.status === 'completed' ? 'selected' : ''}>Completed</option>
                            </select>
                        </div>
                        <div class="action-plan-field" style="align-self: flex-end;">
                            <button class="delete-item-btn" onclick="deleteActionPlanItem(${item.id})">Delete</button>
                        </div>
                    </div>
                    <div class="action-plan-field">
                        <label class="action-plan-label">Action / Notes</label>
                        <textarea class="action-plan-textarea" 
                                  onchange="updateActionPlanItem(${item.id}, 'action', this.value)"
                                  placeholder="Describe the action required or add notes...">${item.action || ''}</textarea>
                    </div>
                </div>
            `;
        }).join('');
    }
}

function toggleItem(sectionId, itemId) {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    let items;
    if (session.data[sectionId]) {
        items = session.data[sectionId];
    } else {
        const customSection = session.data.customSections.find(s => s.id === sectionId);
        items = customSection ? customSection.items : [];
    }
    
    const item = items.find(i => i.id === itemId);
    if (item) {
        item.completed = !item.completed;
        renderSection(sectionId);
        autoSave();
    }
}

function setItemStatus(sectionId, itemId, status) {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    let items;
    if (session.data[sectionId]) {
        items = session.data[sectionId];
    } else {
        const customSection = session.data.customSections.find(s => s.id === sectionId);
        items = customSection ? customSection.items : [];
    }
    
    const item = items.find(i => i.id === itemId);
    if (item) {
        item.status = item.status === status ? null : status;
        renderSection(sectionId);
        autoSave();
    }
}

function updateItemText(sectionId, itemId, text) {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    let items;
    if (session.data[sectionId]) {
        items = session.data[sectionId];
    } else {
        const customSection = session.data.customSections.find(s => s.id === sectionId);
        items = customSection ? customSection.items : [];
    }
    
    const item = items.find(i => i.id === itemId);
    if (item) {
        item.text = text;
        autoSave();
    }
}

function deleteItem(sectionId, itemId) {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    if (session.data[sectionId]) {
        session.data[sectionId] = session.data[sectionId].filter(i => i.id !== itemId);
    } else {
        const customSection = session.data.customSections.find(s => s.id === sectionId);
        if (customSection) {
            customSection.items = customSection.items.filter(i => i.id !== itemId);
        }
    }
    renderSection(sectionId);
    autoSave();
}

function updateItemProgress(sectionId, itemId) {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    let items;
    if (session.data[sectionId]) {
        items = session.data[sectionId];
    } else {
        const customSection = session.data.customSections.find(s => s.id === sectionId);
        items = customSection ? customSection.items : [];
    }
    
    const item = items.find(i => i.id === itemId);
    if (!item) return;
    
    const currentInput = document.getElementById(`progress-current-${itemId}`);
    const targetInput = document.getElementById(`progress-target-${itemId}`);
    
    const current = parseFloat(currentInput.value) || 0;
    const target = parseFloat(targetInput.value) || 100;
    
    item.progress = current;
    item.target = target;
    
    renderSection(sectionId);
    autoSave();
}

function renderSection(sectionId) {
    const container = document.getElementById(`${sectionId}-items`);
    if (!container) return;
    
    const session = sessions[currentSessionId];
    if (!session) return;
    
    let items;
    if (session.data[sectionId]) {
        items = session.data[sectionId];
    } else {
        const customSection = session.data.customSections.find(s => s.id === sectionId);
        items = customSection ? customSection.items : [];
    }
    
    const isMonthlyTarget = sectionId === 'monthly';
    const isWeeklyTarget = sectionId === 'weekly';
    
    if (items.length === 0) {
        container.innerHTML = '<div class="empty-state">No items added yet. Click "+ Add" to get started.</div>';
    } else {
        container.innerHTML = items.map(item => {
            if (item.progress === undefined) item.progress = 0;
            if (item.target === undefined) item.target = 100;
            
            let percentage = 0;
            if (isMonthlyTarget && item.target > 0) {
                percentage = Math.min(Math.round((item.progress / item.target) * 100), 100);
            }
            
            let barColor = '#3b82f6';
            if (percentage >= 100) barColor = '#16a34a';
            else if (percentage >= 75) barColor = '#3b82f6';
            else if (percentage >= 50) barColor = '#f97316';
            else if (percentage > 0) barColor = '#ef4444';
            
            return `
                <div class="item">
                    ${isWeeklyTarget ? `
                        <div class="item-status-buttons">
                            <button class="status-btn hit ${item.status === 'hit' ? 'active' : ''}" 
                                    onclick="setItemStatus('${sectionId}', ${item.id}, 'hit')"
                                    title="Target Hit">‚úì Hit</button>
                            <button class="status-btn miss ${item.status === 'miss' ? 'active' : ''}" 
                                    onclick="setItemStatus('${sectionId}', ${item.id}, 'miss')"
                                    title="Target Missed">‚úó Miss</button>
                        </div>
                    ` : !isMonthlyTarget ? `
                        <input type="checkbox" 
                               class="item-checkbox" 
                               ${item.completed ? 'checked' : ''} 
                               onchange="toggleItem('${sectionId}', ${item.id})">
                    ` : ''}
                    <div class="item-content" style="flex: 1;">
                        <div class="item-text ${item.completed ? 'item-completed' : ''}" 
                             contenteditable="true"
                             onblur="updateItemText('${sectionId}', ${item.id}, this.innerText)">${item.text || ''}</div>
                        
                        ${isMonthlyTarget ? `
                            <div class="item-progress-section">
                                <div class="item-progress-inputs">
                                    <span class="item-progress-label">Current:</span>
                                    <input type="number" 
                                           class="item-progress-input" 
                                           id="progress-current-${item.id}"
                                           value="${item.progress || 0}"
                                           min="0">
                                    <span class="item-progress-label">Target:</span>
                                    <input type="number" 
                                           class="item-progress-input" 
                                           id="progress-target-${item.id}"
                                           value="${item.target || 100}"
                                           min="1">
                                    <button class="update-progress-btn" onclick="updateItemProgress('${sectionId}', ${item.id})">Update</button>
                                </div>
                                <div class="item-progress-bar-container">
                                    <div class="item-progress-bar-fill" style="width: ${percentage}%; background: ${barColor};">
                                        ${percentage >= 10 ? percentage + '%' : ''}
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    <button class="delete-item-btn" onclick="deleteItem('${sectionId}', ${item.id})">Delete</button>
                </div>
            `;
        }).join('');
    }
}

function addCustomSection() {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    const sectionName = prompt('Enter section name:');
    if (!sectionName || !sectionName.trim()) return;
    
    const section = {
        id: 'custom-' + Date.now(),
        name: sectionName.trim(),
        items: []
    };
    
    session.data.customSections.push(section);
    renderCustomSections();
    autoSave();
}

function updateSectionName(sectionId, newName) {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    const customSection = session.data.customSections.find(s => s.id === sectionId);
    if (customSection) {
        customSection.name = newName;
        autoSave();
    }
}

function deleteCustomSection(sectionId) {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    if (confirm('Delete this section and all its items?')) {
        session.data.customSections = session.data.customSections.filter(s => s.id !== sectionId);
        renderCustomSections();
        autoSave();
    }
}

function renderCustomSections() {
    const container = document.getElementById('custom-sections');
    if (!container) return;
    
    const session = sessions[currentSessionId];
    if (!session) return;
    
    container.innerHTML = session.data.customSections.map(section => `
        <div class="tracker-card custom-section">
            <div class="section-header">
                <div class="section-title">
                    <span>üìå</span>
                    <input type="text" 
                           class="section-title-editable" 
                           value="${section.name}"
                           onblur="updateSectionName('${section.id}', this.value)">
                </div>
                <button class="delete-section-btn" onclick="deleteCustomSection('${section.id}')">Delete Section</button>
                <button class="add-item-btn" onclick="addItem('${section.id}')">+ Add Item</button>
            </div>
            <div class="items-container" id="${section.id}-items"></div>
        </div>
    `).join('');
    
    session.data.customSections.forEach(section => {
        renderSection(section.id);
    });
}

function updateMonthlyGoal() {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    const targetInput = document.getElementById('monthly-target-input');
    const currentInput = document.getElementById('monthly-current-input');
    
    const target = parseFloat(targetInput.value) || 0;
    const current = parseFloat(currentInput.value) || 0;
    
    if (target <= 0) {
        alert('Please enter a valid target greater than 0');
        return;
    }
    
    if (!session.data.monthlyGoal) {
        session.data.monthlyGoal = {};
    }
    
    session.data.monthlyGoal.target = target;
    session.data.monthlyGoal.current = current;
    
    renderMonthlyProgress();
    autoSave();
}

function renderMonthlyProgress() {
    const session = sessions[currentSessionId];
    if (!session) return;
    
    if (!session.data.monthlyGoal) {
        session.data.monthlyGoal = { target: 100, current: 0 };
    }
    
    const goal = session.data.monthlyGoal;
    const target = goal.target || 100;
    const current = goal.current || 0;
    
    const percentage = Math.min(Math.round((current / target) * 100), 100);
    const remaining = Math.max(target - current, 0);
    
    const targetInput = document.getElementById('monthly-target-input');
    const currentInput = document.getElementById('monthly-current-input');
    
    if (targetInput) targetInput.value = target;
    if (currentInput) currentInput.value = current;
    
    const percentageEl = document.getElementById('monthly-percentage');
    if (percentageEl) {
        percentageEl.textContent = percentage + '%';
        
        if (percentage >= 100) {
            percentageEl.style.color = '#16a34a';
        } else if (percentage >= 75) {
            percentageEl.style.color = '#1e40af';
        } else if (percentage >= 50) {
            percentageEl.style.color = '#ea580c';
        } else {
            percentageEl.style.color = '#dc2626';
        }
    }
    
    const progressBar = document.getElementById('monthly-progress-bar');
    const progressText = document.getElementById('monthly-progress-text');
    if (progressBar) {
        progressBar.style.width = percentage + '%';
        
        if (percentage >= 100) {
            progressBar.style.background = 'linear-gradient(90deg, #16a34a 0%, #15803d 100%)';
        } else if (percentage >= 75) {
            progressBar.style.background = 'linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%)';
        } else if (percentage >= 50) {
            progressBar.style.background = 'linear-gradient(90deg, #f97316 0%, #ea580c 100%)';
        } else {
            progressBar.style.background = 'linear-gradient(90deg, #ef4444 0%, #dc2626 100%)';
        }
    }
    
    if (progressText) {
        if (percentage >= 15) {
            progressText.textContent = percentage + '%';
        } else {
            progressText.textContent = '';
        }
    }
    
    const currentStat = document.getElementById('monthly-current-stat');
    const targetStat = document.getElementById('monthly-target-stat');
    const remainingStat = document.getElementById('monthly-remaining-stat');
    
    if (currentStat) currentStat.textContent = current.toLocaleString();
    if (targetStat) targetStat.textContent = target.toLocaleString();
    if (remainingStat) remainingStat.textContent = remaining.toLocaleString();
}

function exportToPDF() {
    saveCurrentSession();
    
    const style = document.createElement('style');
    style.textContent = `
        @media print {
            body { background: white; }
            .session-controls, .add-item-btn, .delete-item-btn, 
            .delete-section-btn, .update-goal-btn, .update-progress-btn,
            .add-section-btn, .item-status-buttons, .item-checkbox,
            .delete-session-btn-main, .copy-session-btn, .new-session-btn, .carryforward-session-btn,
            .controls {
                display: none !important;
            }
            .tracker-card { page-break-inside: avoid; }
        }
    `;
    document.head.appendChild(style);
    
    window.print();
    
    setTimeout(() => document.head.removeChild(style), 1000);
}

function showAnalyticsModal() {
    let modal = document.getElementById('analytics-modal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'analytics-modal';
        modal.style.cssText = `
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        `;
        document.body.appendChild(modal);
    }
    
    const analytics = calculateAnalytics();
    
    modal.innerHTML = `
        <div style="background: white; border-radius: 12px; padding: 30px; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0;">
                <h2 style="font-size: 1.8em; color: #2d3748;">üìà Trends & Analytics</h2>
                <button onclick="closeAnalyticsModal()" style="font-size: 2em; cursor: pointer; border: none; background: none; color: #a0aec0;">√ó</button>
            </div>
            
            <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="font-size: 1.2em; font-weight: 600; margin-bottom: 15px; color: #2d3748;">Weekly Targets Hit Rate Over Time</h3>
                <div id="weekly-chart" style="display: flex; align-items: flex-end; gap: 10px; height: 200px; padding: 10px 0;"></div>
            </div>
            
            <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="font-size: 1.2em; font-weight: 600; margin-bottom: 15px; color: #2d3748;">Monthly Progress Trend</h3>
                <div id="monthly-chart" style="display: flex; align-items: flex-end; gap: 10px; height: 200px; padding: 10px 0;"></div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="background: #f7fafc; padding: 20px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: 700; color: #667eea;">${analytics.avgWeeklyHitRate}%</div>
                    <div style="font-size: 0.9em; color: #4a5568; margin-top: 5px;">Avg Weekly Hit Rate</div>
                </div>
                <div style="background: #f7fafc; padding: 20px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: 700; color: #667eea;">${analytics.totalActionItems}</div>
                    <div style="font-size: 0.9em; color: #4a5568; margin-top: 5px;">Total Action Items</div>
                </div>
                <div style="background: #f7fafc; padding: 20px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: 700; color: #667eea;">${analytics.completionRate}%</div>
                    <div style="font-size: 0.9em; color: #4a5568; margin-top: 5px;">Completion Rate</div>
                </div>
                <div style="background: #f7fafc; padding: 20px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 2em; font-weight: 700; color: #667eea;">${analytics.totalSessions}</div>
                    <div style="font-size: 0.9em; color: #4a5568; margin-top: 5px;">Total Sessions</div>
                </div>
            </div>
        </div>
    `;
    
    modal.style.display = 'flex';
    
    setTimeout(() => {
        renderWeeklyChart(analytics.weeklyData);
        renderMonthlyChart(analytics.monthlyData);
    }, 100);
}

function closeAnalyticsModal() {
    const modal = document.getElementById('analytics-modal');
    if (modal) {
        modal.style.display = 'none';
    }
}

function calculateAnalytics() {
    const sessionIds = Object.keys(sessions).sort((a, b) => {
        return new Date(sessions[a].date) - new Date(sessions[b].date);
    });
    
    const weeklyData = [];
    const monthlyData = [];
    let totalActionItems = 0;
    let completedActionItems = 0;
    let totalWeeklyHits = 0;
    let totalWeeklyTargets = 0;
    
    sessionIds.forEach(sessionId => {
        const session = sessions[sessionId];
        const date = new Date(session.date);
        const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;
        
        const weeklyTargets = session.data.weekly || [];
        const hits = weeklyTargets.filter(t => t.status === 'hit').length;
        const total = weeklyTargets.length;
        
        if (total > 0) {
            const hitRate = Math.round((hits / total) * 100);
            weeklyData.push({ date: dateStr, value: hitRate });
            totalWeeklyHits += hits;
            totalWeeklyTargets += total;
        }
        
        if (session.data.monthlyGoal) {
            const progress = session.data.monthlyGoal.current || 0;
            monthlyData.push({ date: dateStr, value: progress });
        }
        
        const actionPlan = session.data.actionPlan || [];
        totalActionItems += actionPlan.length;
        completedActionItems += actionPlan.filter(a => a.status === 'completed').length;
    });
    
    const avgWeeklyHitRate = totalWeeklyTargets > 0 
        ? Math.round((totalWeeklyHits / totalWeeklyTargets) * 100) 
        : 0;
    
    const completionRate = totalActionItems > 0 
        ? Math.round((completedActionItems / totalActionItems) * 100) 
        : 0;
    
    return {
        weeklyData,
        monthlyData,
        avgWeeklyHitRate,
        totalActionItems,
        completionRate,
        totalSessions: sessionIds.length
    };
}

function renderWeeklyChart(data) {
    const container = document.getElementById('weekly-chart');
    if (!container || data.length === 0) {
        if (container) container.innerHTML = '<p style="text-align: center; color: #a0aec0;">No data available</p>';
        return;
    }
    
    const maxValue = Math.max(...data.map(d => d.value), 100);
    
    container.innerHTML = data.slice(-10).map(item => {
        const height = (item.value / maxValue) * 100;
        
        let barColor = '#ef4444';
        if (item.value >= 100) {
            barColor = '#16a34a';
        } else if (item.value >= 80) {
            barColor = '#f97316';
        }
        
        return `
            <div style="flex: 1; background: ${barColor}; border-radius: 4px 4px 0 0; position: relative; min-height: 20px; height: ${height}%; transition: all 0.3s; cursor: pointer;" title="${item.value}% on ${item.date}">
                <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 0.85em; font-weight: 600; color: #2d3748;">${item.value}%</div>
                <div style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); font-size: 0.8em; color: #4a5568; white-space: nowrap;">${item.date}</div>
            </div>
        `;
    }).join('');
}

function renderMonthlyChart(data) {
    const container = document.getElementById('monthly-chart');
    if (!container || data.length === 0) {
        if (container) container.innerHTML = '<p style="text-align: center; color: #a0aec0;">No data available</p>';
        return;
    }
    
    const maxValue = Math.max(...data.map(d => d.value), 1);
    
    container.innerHTML = data.slice(-10).map((item, index) => {
        const height = maxValue > 0 ? (item.value / maxValue) * 100 : 0;
        
        const session = Object.values(sessions).find(s => {
            const date = new Date(s.date);
            return `${date.getMonth() + 1}/${date.getDate()}` === item.date;
        });
        
        let barColor = '#667eea';
        if (session && session.data.monthlyGoal && session.data.monthlyGoal.target > 0) {
            const percentage = Math.round((item.value / session.data.monthlyGoal.target) * 100);
            
            if (percentage >= 100) {
                barColor = '#16a34a';
            } else if (percentage >= 80) {
                barColor = '#f97316';
            } else {
                barColor = '#ef4444';
            }
        }
        
        return `
            <div style="flex: 1; background: ${barColor}; border-radius: 4px 4px 0 0; position: relative; min-height: 20px; height: ${Math.max(height, 5)}%; transition: all 0.3s; cursor: pointer;" title="${item.value} on ${item.date}">
                <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 0.85em; font-weight: 600; color: #2d3748;">${item.value}</div>
                <div style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); font-size: 0.8em; color: #4a5568; white-space: nowrap;">${item.date}</div>
            </div>
        `;
    }).join('');
}
const THEME_KEY = 'coachingTracker_theme';

function setTheme(theme) {
    const isLight = theme === 'light';
    document.body.classList.toggle('light-theme', isLight);
    const btn = document.getElementById('theme-toggle');
    if (btn) {
        btn.textContent = isLight ? '‚òæ Dark Mode' : '‚òÄ Light Mode';
    }
    try {
        localStorage.setItem(THEME_KEY, theme);
    } catch (e) {
        console.warn('Unable to save theme preference', e);
    }
}

function initTheme() {
    let saved = 'dark';
    try {
        saved = localStorage.getItem(THEME_KEY) || 'dark';
    } catch (e) {
        saved = 'dark';
    }
    setTheme(saved);
}

function toggleTheme() {
    const isLight = document.body.classList.contains('light-theme');
    setTheme(isLight ? 'dark' : 'light');
}

document.addEventListener('DOMContentLoaded', function() {
    initTheme();          // NEW: load saved theme first
    initializeSessions(); // EXISTING
});

window.addEventListener('beforeunload', function() {
    saveCurrentSession();
    saveToStorage();
});
    </script>
</body>
</html>