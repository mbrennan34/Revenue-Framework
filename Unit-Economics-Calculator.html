<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Unit Economics Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .section-header h2 {
            color: #333;
            font-size: 24px;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tooltip {
            cursor: help;
            color: #667eea;
            font-size: 12px;
        }

        .input-group input, .input-group select {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group.calculated {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
        }

        .input-group.calculated input {
            background: white;
            border-color: #2196f3;
            font-weight: 600;
            color: #1565c0;
        }

        .btn {
            padding: 14px 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 26px;
            font-weight: bold;
        }

        .stat-card .subvalue {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .stat-card.success {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }

        .stat-card.danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }

        .stat-card.info {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .info-box h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .info-box p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #666;
            line-height: 1.8;
        }

        .info-box.success {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }

        .info-box.success h4 {
            color: #4caf50;
        }

        .info-box.warning {
            background: #fff3e0;
            border-left-color: #ff9800;
        }

        .info-box.warning h4 {
            color: #ff9800;
        }

        .info-box.danger {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .info-box.danger h4 {
            color: #f44336;
        }

        .comparison-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .comparison-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .comparison-table tr:hover {
            background: #f8f9fa;
        }

        .benchmark-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .benchmark-excellent {
            background: #4caf50;
            color: white;
        }

        .benchmark-good {
            background: #8bc34a;
            color: white;
        }

        .benchmark-acceptable {
            background: #ff9800;
            color: white;
        }

        .benchmark-poor {
            background: #f44336;
            color: white;
        }

        .chart-container {
            position: relative;
            height: 350px;
            margin: 25px 0;
        }

        .metric-explainer {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 3px solid #667eea;
        }

        .metric-explainer h5 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .metric-explainer p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .export-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
        }

        .export-section h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .dynamic-line-item {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 10px;
            align-items: end;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .dynamic-line-item input {
            margin: 0;
        }

        .btn-remove {
            padding: 10px 16px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-remove:hover {
            background: #d32f2f;
            transform: translateY(-1px);
        }

        .btn-add {
            padding: 10px 20px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .btn-add:hover {
            background: #388e3c;
            transform: translateY(-1px);
        }

        .line-items-container {
            margin-bottom: 20px;
        }

        .section-divider {
            border-top: 2px dashed #e0e0e0;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .input-grid {
                grid-template-columns: 1fr;
            }

            .dynamic-line-item {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }
    </style>
</head>
<body>

<div class="controls">
  <button class="btn" onclick="window.location.href='Goal Seek.html'">Goal Seek</button>
    <button class="btn" onclick="window.location.href='SaaS-Growth-Sim.html'">Monte Carlo Sim</button>

</div>

    <div class="container">
        <div class="header">
            <h1>üí∞ SaaS Unit Economics Calculator</h1>
            <p>Calculate CAC, LTV, Payback Period, and validate financial sustainability</p>
        </div>

        <div class="controls">
            <button class="btn" onclick="window.location.href='Goal-Seeking-Revenue-Planner.html'">üìä Go to Revenue Planner</button>
        </div>

        <!-- Revenue & Pricing -->
        <div class="card">
            <div class="section-header">
                <h2>üíµ Revenue & Pricing Model</h2>
            </div>

            <div class="input-grid">
                <div class="input-group">
                    <label>
                        Average Contract Value (ACV) ‚Ç¨
                        <span class="tooltip" title="Annual value per customer">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" id="acv" value="15000" min="0">
                </div>

                <div class="input-group">
                    <label>
                        Contract Length (Months)
                        <span class="tooltip" title="Typical contract duration">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" id="contract_length" value="12" min="1" max="60">
                </div>

                <div class="input-group">
                    <label>
                        Monthly Churn Rate %
                        <span class="tooltip" title="% of customers lost per month">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" id="churn_rate" value="2.5" min="0" max="100" step="0.1">
                </div>

                <div class="input-group">
                    <label>
                        Average Customer Lifetime (Months)
                        <span class="tooltip" title="Auto-calculated from churn">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" id="customer_lifetime" readonly style="background: #e3f2fd;">
                </div>
            </div>
        </div>

        <!-- Cost of Goods Sold (COGS) -->
        <div class="card">
            <div class="section-header">
                <h2>üì¶ Cost of Goods Sold (COGS)</h2>
            </div>

            <div class="info-box">
                <h4>What is COGS?</h4>
                <p>Direct costs to deliver your service: hosting, support, infrastructure. Excludes sales, marketing, and R&D.</p>
                <p><strong>Add your specific cost line items below.</strong> Examples: hosting, support, data costs, API fees, professional services, onboarding costs.</p>
            </div>

            <div class="line-items-container" id="cogs_items"></div>

            <button class="btn-add" onclick="addCOGSItem()">+ Add Cost Item</button>

            <div class="section-divider"></div>

            <div class="input-grid">
                <div class="input-group calculated">
                    <label>
                        <strong>Total COGS per Customer ‚Ç¨</strong>
                    </label>
                    <input type="number" id="total_cogs" readonly>
                </div>

                <div class="input-group calculated">
                    <label>
                        <strong>Gross Margin %</strong>
                    </label>
                    <input type="number" id="gross_margin" readonly>
                </div>

                <div class="input-group calculated">
                    <label>
                        <strong>Gross Profit per Customer ‚Ç¨</strong>
                    </label>
                    <input type="number" id="gross_profit" readonly>
                </div>
            </div>
        </div>

        <!-- Customer Acquisition Cost (CAC) -->
        <div class="card">
            <div class="section-header">
                <h2>üéØ Customer Acquisition Cost (CAC)</h2>
            </div>

            <div class="info-box">
                <h4>What is CAC?</h4>
                <p>Total Sales & Marketing expenses divided by number of new customers acquired. The fully-loaded cost to win one customer.</p>
                <p><strong>Add all your S&M cost items below.</strong> Examples: sales salaries, commissions, marketing spend, SDR costs, enablement, tools, events.</p>
            </div>

            <div class="line-items-container" id="cac_items"></div>

            <button class="btn-add" onclick="addCACItem()">+ Add S&M Cost Item</button>

            <div class="section-divider"></div>

            <div class="input-grid">
                <div class="input-group">
                    <label>
                        New Customers per Month
                        <span class="tooltip" title="Average monthly acquisition">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" id="customers_per_month" value="25" min="1">
                </div>

                <div class="input-group calculated">
                    <label>
                        <strong>Total Monthly S&M Cost ‚Ç¨</strong>
                    </label>
                    <input type="number" id="total_sm_cost" readonly>
                </div>

                <div class="input-group calculated">
                    <label>
                        <strong>CAC (Customer Acquisition Cost) ‚Ç¨</strong>
                    </label>
                    <input type="number" id="cac" readonly>
                </div>

                <div class="input-group calculated">
                    <label>
                        <strong>CAC as % of ACV</strong>
                    </label>
                    <input type="number" id="cac_percent" readonly>
                </div>
            </div>
        </div>

        <!-- Calculate Button -->
        <div class="card">
            <button class="btn" onclick="calculateUnitEconomics()" style="width: 100%; font-size: 18px; padding: 20px;">
                üßÆ Calculate Unit Economics
            </button>
        </div>

        <!-- Results -->
        <div id="results" style="display: none;">
            <!-- Key Metrics -->
            <div class="card">
                <div class="section-header">
                    <h2>üìä Key Metrics</h2>
                </div>

                <div class="results-grid" id="key_metrics"></div>
            </div>

            <!-- Health Assessment -->
            <div class="card" id="health_assessment"></div>

            <!-- LTV:CAC Analysis -->
            <div class="card">
                <div class="section-header">
                    <h2>üéØ LTV:CAC Ratio Analysis</h2>
                </div>

                <div class="chart-container">
                    <canvas id="ltv_cac_chart"></canvas>
                </div>

                <div id="ltv_cac_explanation"></div>
            </div>

            <!-- Payback Period Analysis -->
            <div class="card">
                <div class="section-header">
                    <h2>‚è±Ô∏è Payback Period Analysis</h2>
                </div>

                <div class="chart-container">
                    <canvas id="payback_chart"></canvas>
                </div>

                <div id="payback_explanation"></div>
            </div>

            <!-- Gross Margin Analysis -->
            <div class="card">
                <div class="section-header">
                    <h2>üí∞ Gross Margin Deep Dive</h2>
                </div>

                <div class="chart-container">
                    <canvas id="margin_chart"></canvas>
                </div>

                <div id="margin_breakdown"></div>
            </div>

            <!-- Benchmarks -->
            <div class="card">
                <div class="section-header">
                    <h2>üèÜ Industry Benchmarks</h2>
                </div>

                <table class="comparison-table" id="benchmarks_table"></table>
            </div>

            <!-- Export to Revenue Planner -->
            <div class="card">
                <div class="section-header">
                    <h2>üì§ Export to Revenue Planner</h2>
                </div>

                <div class="export-section">
                    <h3>Your Validated Unit Economics</h3>
                    <p style="color: #666; margin-bottom: 15px;">These metrics will automatically populate the Revenue Planner with realistic constraints.</p>
                    
                    <div id="export_summary"></div>

                    <button class="btn btn-secondary" onclick="exportToPlanner()" style="margin-top: 15px;">
                        üìä Open Revenue Planner with These Economics
                    </button>
                </div>
            </div>

            <!-- Sensitivity Analysis -->
            <div class="card">
                <div class="section-header">
                    <h2>üî¨ Sensitivity Analysis</h2>
                </div>

                <div class="info-box">
                    <h4>What If Scenarios</h4>
                    <p>See how changes to key variables impact your unit economics</p>
                </div>

                <div id="sensitivity_analysis"></div>
            </div>
        </div>
    </div>

    <script>
        let currentCalculation = null;
        let charts = {};
        let cogsItemCounter = 0;
        let cacItemCounter = 0;

        // COGS Management
        const defaultCOGSItems = [
            { name: 'Hosting & Infrastructure', value: 500 },
            { name: 'Customer Support', value: 1000 },
            { name: 'Data & API Costs', value: 500 }
        ];

        // CAC Management
        const defaultCACItems = [
            { name: 'Sales Team Salaries & Commissions', value: 40000 },
            { name: 'Marketing Spend', value: 15000 },
            { name: 'SDR Team', value: 10000 },
            { name: 'Sales Tools & Software', value: 5000 }
        ];

        function addCOGSItem(name = '', value = 0) {
            const container = document.getElementById('cogs_items');
            const itemId = `cogs_item_${cogsItemCounter++}`;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'dynamic-line-item';
            itemDiv.id = itemId;
            itemDiv.innerHTML = `
                <div class="input-group">
                    <label>Cost Item Name</label>
                    <input type="text" 
                           class="cogs-name" 
                           value="${name}" 
                           placeholder="e.g., Hosting, Support, APIs"
                           onchange="updateCOGS()">
                </div>
                <div class="input-group">
                    <label>Annual Cost per Customer ‚Ç¨</label>
                    <input type="number" 
                           class="cogs-value" 
                           value="${value}" 
                           min="0"
                           oninput="updateCOGS()">
                </div>
                <button class="btn-remove" onclick="removeCOGSItem('${itemId}')">üóëÔ∏è Remove</button>
            `;
            
            container.appendChild(itemDiv);
            updateCOGS();
        }

        function removeCOGSItem(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.remove();
                updateCOGS();
            }
        }

        function addCACItem(name = '', value = 0) {
            const container = document.getElementById('cac_items');
            const itemId = `cac_item_${cacItemCounter++}`;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'dynamic-line-item';
            itemDiv.id = itemId;
            itemDiv.innerHTML = `
                <div class="input-group">
                    <label>Cost Item Name</label>
                    <input type="text" 
                           class="cac-name" 
                           value="${name}" 
                           placeholder="e.g., Sales Team, Marketing, Events"
                           onchange="updateCAC()">
                </div>
                <div class="input-group">
                    <label>Monthly Cost ‚Ç¨</label>
                    <input type="number" 
                           class="cac-value" 
                           value="${value}" 
                           min="0"
                           oninput="updateCAC()">
                </div>
                <button class="btn-remove" onclick="removeCACItem('${itemId}')">üóëÔ∏è Remove</button>
            `;
            
            container.appendChild(itemDiv);
            updateCAC();
        }

        function removeCACItem(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.remove();
                updateCAC();
            }
        }

        function getAllCOGSItems() {
            const items = [];
            document.querySelectorAll('#cogs_items .dynamic-line-item').forEach(item => {
                const name = item.querySelector('.cogs-name').value;
                const value = parseFloat(item.querySelector('.cogs-value').value) || 0;
                items.push({ name, value });
            });
            return items;
        }

        function getAllCACItems() {
            const items = [];
            document.querySelectorAll('#cac_items .dynamic-line-item').forEach(item => {
                const name = item.querySelector('.cac-name').value;
                const value = parseFloat(item.querySelector('.cac-value').value) || 0;
                items.push({ name, value });
            });
            return items;
        }

        function updateCOGS() {
            const items = getAllCOGSItems();
            const totalCOGS = items.reduce((sum, item) => sum + item.value, 0);
            const acv = parseFloat(document.getElementById('acv').value) || 0;

            document.getElementById('total_cogs').value = totalCOGS.toFixed(0);

            if (acv > 0) {
                const grossMargin = ((acv - totalCOGS) / acv) * 100;
                document.getElementById('gross_margin').value = grossMargin.toFixed(1);
                
                const grossProfit = acv - totalCOGS;
                document.getElementById('gross_profit').value = grossProfit.toFixed(0);
            }
        }

        function updateCAC() {
            const items = getAllCACItems();
            const totalSMCost = items.reduce((sum, item) => sum + item.value, 0);
            const customers = parseFloat(document.getElementById('customers_per_month').value) || 1;
            const acv = parseFloat(document.getElementById('acv').value) || 0;

            document.getElementById('total_sm_cost').value = totalSMCost.toFixed(0);

            const cac = totalSMCost / customers;
            document.getElementById('cac').value = cac.toFixed(0);

            if (acv > 0) {
                const cacPercent = (cac / acv) * 100;
                document.getElementById('cac_percent').value = cacPercent.toFixed(1);
            }
        }

        // Auto-calculate customer lifetime from churn
        document.getElementById('churn_rate').addEventListener('input', function() {
            const churnRate = parseFloat(this.value) / 100;
            if (churnRate > 0) {
                const lifetime = 1 / churnRate;
                document.getElementById('customer_lifetime').value = lifetime.toFixed(1);
            }
        });

        // Add event listeners for ACV changes
        document.getElementById('acv').addEventListener('input', function() {
            updateCOGS();
            updateCAC();
        });

        document.getElementById('customers_per_month').addEventListener('input', updateCAC);

        // Initialize with default items
        document.addEventListener('DOMContentLoaded', function() {
            // Add default COGS items
            defaultCOGSItems.forEach(item => addCOGSItem(item.name, item.value));
            
            // Add default CAC items
            defaultCACItems.forEach(item => addCACItem(item.name, item.value));
            
            document.getElementById('customer_lifetime').value = '40.0';
        });

        function formatCurrency(value) {
            return '‚Ç¨' + value.toLocaleString('en-IE', {maximumFractionDigits: 0});
        }

        function formatPercent(value) {
            return value.toFixed(1) + '%';
        }

        function calculateUnitEconomics() {
            // Gather inputs
            const acv = parseFloat(document.getElementById('acv').value);
            const contractLength = parseFloat(document.getElementById('contract_length').value);
            const churnRate = parseFloat(document.getElementById('churn_rate').value) / 100;
            const customerLifetime = parseFloat(document.getElementById('customer_lifetime').value);
            
            const hostingCost = parseFloat(document.getElementById('hosting_cost').value);
            const supportCost = parseFloat(document.getElementById('support_cost').value);
            const otherCOGS = parseFloat(document.getElementById('other_cogs').value);
            
            const salesCost = parseFloat(document.getElementById('sales_cost').value);
            const marketingCost = parseFloat(document.getElementById('marketing_cost').value);
            const customersPerMonth = parseFloat(document.getElementById('customers_per_month').value);

            // Calculate key metrics
            const totalCOGS = hostingCost + supportCost + otherCOGS;
            const grossProfit = acv - totalCOGS;
            const grossMarginPercent = (grossProfit / acv) * 100;
            
            const cac = (salesCost + marketingCost) / customersPerMonth;
            
            // LTV calculation (using gross profit, not revenue)
            const ltv = grossProfit * customerLifetime;
            
            const ltvCacRatio = ltv / cac;
            
            // Payback period (in months)
            const monthlyGrossProfit = grossProfit / 12;
            const paybackMonths = cac / monthlyGrossProfit;
            
            // Magic Number (efficiency of sales & marketing spend)
            const newARRPerMonth = acv * customersPerMonth;
            const magicNumber = (newARRPerMonth * grossMarginPercent / 100) / (salesCost + marketingCost);

            // CAC as % of ACV
            const cacPercent = (cac / acv) * 100;

            // Store calculation
            currentCalculation = {
                acv, contractLength, churnRate, customerLifetime,
                totalCOGS, grossProfit, grossMarginPercent,
                cac, ltv, ltvCacRatio, paybackMonths, magicNumber, cacPercent,
                salesCost, marketingCost, customersPerMonth
            };

            displayResults(currentCalculation);
        }

        function displayResults(calc) {
            document.getElementById('results').style.display = 'block';

            // Key Metrics Cards
            const keyMetricsHTML = `
                <div class="stat-card ${calc.ltvCacRatio >= 3 ? 'success' : calc.ltvCacRatio >= 2 ? 'warning' : 'danger'}">
                    <h3>LTV:CAC Ratio</h3>
                    <div class="value">${calc.ltvCacRatio.toFixed(2)}:1</div>
                    <div class="subvalue">Target: 3:1 or higher</div>
                </div>

                <div class="stat-card info">
                    <h3>Customer LTV</h3>
                    <div class="value">${formatCurrency(calc.ltv)}</div>
                    <div class="subvalue">Gross profit over lifetime</div>
                </div>

                <div class="stat-card ${calc.cacPercent <= 33 ? 'success' : calc.cacPercent <= 50 ? 'warning' : 'danger'}">
                    <h3>CAC</h3>
                    <div class="value">${formatCurrency(calc.cac)}</div>
                    <div class="subvalue">${calc.cacPercent.toFixed(0)}% of ACV</div>
                </div>

                <div class="stat-card ${calc.paybackMonths <= 12 ? 'success' : calc.paybackMonths <= 18 ? 'warning' : 'danger'}">
                    <h3>Payback Period</h3>
                    <div class="value">${calc.paybackMonths.toFixed(1)}mo</div>
                    <div class="subvalue">Target: <12 months</div>
                </div>

                <div class="stat-card ${calc.grossMarginPercent >= 80 ? 'success' : calc.grossMarginPercent >= 70 ? 'warning' : 'danger'}">
                    <h3>Gross Margin</h3>
                    <div class="value">${formatPercent(calc.grossMarginPercent)}</div>
                    <div class="subvalue">Target: 75-85%</div>
                </div>

                <div class="stat-card ${calc.magicNumber >= 0.75 ? 'success' : calc.magicNumber >= 0.5 ? 'warning' : 'danger'}">
                    <h3>Magic Number</h3>
                    <div class="value">${calc.magicNumber.toFixed(2)}</div>
                    <div class="subvalue">Sales efficiency</div>
                </div>

                <div class="stat-card info">
                    <h3>Gross Profit per Customer</h3>
                    <div class="value">${formatCurrency(calc.grossProfit)}</div>
                    <div class="subvalue">Annual, after COGS</div>
                </div>

                <div class="stat-card info">
                    <h3>Customer Lifetime</h3>
                    <div class="value">${calc.customerLifetime.toFixed(1)}mo</div>
                    <div class="subvalue">Avg. at ${formatPercent(calc.churnRate * 100)} churn</div>
                </div>
            `;

            document.getElementById('key_metrics').innerHTML = keyMetricsHTML;

            // Health Assessment
            displayHealthAssessment(calc);

            // LTV:CAC Chart
            displayLTVCACChart(calc);

            // Payback Chart
            displayPaybackChart(calc);

            // Margin Chart
            displayMarginChart(calc);

            // Benchmarks
            displayBenchmarks(calc);

            // Export Summary
            displayExportSummary(calc);

            // Sensitivity Analysis
            displaySensitivityAnalysis(calc);
        }

        function displayHealthAssessment(calc) {
            let overallHealth = 'good';
            let issues = [];
            let strengths = [];

            // Assess LTV:CAC
            if (calc.ltvCacRatio < 2) {
                overallHealth = 'poor';
                issues.push('LTV:CAC ratio below 2:1 - unit economics are unsustainable');
            } else if (calc.ltvCacRatio < 3) {
                if (overallHealth === 'good') overallHealth = 'acceptable';
                issues.push('LTV:CAC ratio below 3:1 - limited room for growth investment');
            } else {
                strengths.push('Strong LTV:CAC ratio above 3:1');
            }

            // Assess Payback Period
            if (calc.paybackMonths > 18) {
                overallHealth = 'poor';
                issues.push('Payback period over 18 months - cash intensive');
            } else if (calc.paybackMonths > 12) {
                if (overallHealth === 'good') overallHealth = 'acceptable';
                issues.push('Payback period over 12 months - watch cash burn');
            } else {
                strengths.push('Fast payback period under 12 months');
            }

            // Assess Gross Margin
            if (calc.grossMarginPercent < 70) {
                overallHealth = 'poor';
                issues.push('Gross margin below 70% - COGS too high for SaaS');
            } else if (calc.grossMarginPercent < 75) {
                if (overallHealth === 'good') overallHealth = 'acceptable';
                issues.push('Gross margin below 75% - room to optimize COGS');
            } else {
                strengths.push('Healthy gross margin above 75%');
            }

            // Assess CAC as % of ACV
            if (calc.cacPercent > 50) {
                overallHealth = 'poor';
                issues.push('CAC is over 50% of ACV - acquisition too expensive');
            } else if (calc.cacPercent > 33) {
                if (overallHealth === 'good') overallHealth = 'acceptable';
                issues.push('CAC is over 33% of ACV - consider reducing acquisition costs');
            } else {
                strengths.push('Efficient CAC under 33% of ACV');
            }

            // Assess Magic Number
            if (calc.magicNumber < 0.5) {
                overallHealth = 'poor';
                issues.push('Magic number below 0.5 - sales & marketing are inefficient');
            } else if (calc.magicNumber < 0.75) {
                if (overallHealth === 'good') overallHealth = 'acceptable';
                issues.push('Magic number below 0.75 - room to improve efficiency');
            } else {
                strengths.push('Strong magic number above 0.75');
            }

            const healthClass = overallHealth === 'good' ? 'success' : overallHealth === 'acceptable' ? 'warning' : 'danger';
            const healthEmoji = overallHealth === 'good' ? '‚úÖ' : overallHealth === 'acceptable' ? '‚ö†Ô∏è' : 'üö®';

            let html = `
                <div class="info-box ${healthClass}">
                    <h4>${healthEmoji} Overall Health: ${overallHealth.toUpperCase()}</h4>
            `;

            if (strengths.length > 0) {
                html += '<p><strong>Strengths:</strong></p><ul>';
                strengths.forEach(s => html += `<li>${s}</li>`);
                html += '</ul>';
            }

            if (issues.length > 0) {
                html += '<p><strong>Areas for Improvement:</strong></p><ul>';
                issues.forEach(i => html += `<li>${i}</li>`);
                html += '</ul>';
            }

            html += '</div>';

            document.getElementById('health_assessment').innerHTML = html;
        }

        function displayLTVCACChart(calc) {
            const ctx = document.getElementById('ltv_cac_chart');
            
            if (charts.ltvCac) charts.ltvCac.destroy();

            charts.ltvCac = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Your Business', 'Minimum Viable', 'Good', 'Excellent'],
                    datasets: [{
                        label: 'LTV:CAC Ratio',
                        data: [calc.ltvCacRatio, 2, 3, 5],
                        backgroundColor: [
                            calc.ltvCacRatio >= 3 ? '#4caf50' : calc.ltvCacRatio >= 2 ? '#ff9800' : '#f44336',
                            '#f44336',
                            '#ff9800',
                            '#4caf50'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'LTV:CAC Ratio'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            let explanation = '<div class="metric-explainer"><h5>What This Means</h5>';
            
            if (calc.ltvCacRatio >= 3) {
                explanation += `<p>‚úÖ <strong>Excellent!</strong> Your LTV:CAC of ${calc.ltvCacRatio.toFixed(2)}:1 means you generate ${formatCurrency(calc.ltv)} in gross profit for every ${formatCurrency(calc.cac)} spent acquiring a customer. This is healthy and sustainable.</p>`;
            } else if (calc.ltvCacRatio >= 2) {
                explanation += `<p>‚ö†Ô∏è <strong>Acceptable but tight.</strong> Your LTV:CAC of ${calc.ltvCacRatio.toFixed(2)}:1 leaves limited room for other costs. Aim to improve to 3:1 by reducing CAC or increasing customer lifetime.</p>`;
            } else {
                explanation += `<p>üö® <strong>Unsustainable.</strong> Your LTV:CAC of ${calc.ltvCacRatio.toFixed(2)}:1 means you're not recovering acquisition costs adequately. The business will burn cash. Fix urgently by reducing CAC or improving retention.</p>`;
            }

            explanation += '</div>';
            document.getElementById('ltv_cac_explanation').innerHTML = explanation;
        }

        function displayPaybackChart(calc) {
            const ctx = document.getElementById('payback_chart');
            
            if (charts.payback) charts.payback.destroy();

            // Generate cumulative profit curve
            const months = Math.ceil(Math.max(calc.paybackMonths * 1.5, 24));
            const monthlyGrossProfit = calc.grossProfit / 12;
            
            const labels = [];
            const cumulativeData = [];
            let cumulative = -calc.cac;

            for (let i = 0; i <= months; i++) {
                labels.push(i);
                cumulativeData.push(cumulative);
                if (i > 0) {
                    cumulative += monthlyGrossProfit;
                }
            }

            charts.payback = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Cumulative Profit per Customer',
                        data: cumulativeData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Cumulative Profit (‚Ç¨)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '‚Ç¨' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Months Since Acquisition'
                            }
                        }
                    },
                    plugins: {
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: 0,
                                    yMax: 0,
                                    borderColor: '#f44336',
                                    borderWidth: 2,
                                    label: {
                                        content: 'Break-even',
                                        enabled: true
                                    }
                                }
                            }
                        }
                    }
                }
            });

            let explanation = '<div class="metric-explainer"><h5>Payback Period Analysis</h5>';
            
            if (calc.paybackMonths <= 12) {
                explanation += `<p>‚úÖ <strong>Excellent!</strong> You recover your CAC in ${calc.paybackMonths.toFixed(1)} months. Fast payback means less cash required to scale.</p>`;
            } else if (calc.paybackMonths <= 18) {
                explanation += `<p>‚ö†Ô∏è <strong>Acceptable.</strong> ${calc.paybackMonths.toFixed(1)} month payback means you need cash reserves to fund growth. Target under 12 months.</p>`;
            } else {
                explanation += `<p>üö® <strong>Too slow.</strong> ${calc.paybackMonths.toFixed(1)} month payback is very cash intensive. You'll need significant capital to scale. Reduce CAC or increase early value.</p>`;
            }

            explanation += `<p><strong>What it means:</strong> If you invest ${formatCurrency(calc.cac)} to acquire a customer today, you'll have that money back in ${calc.paybackMonths.toFixed(1)} months from gross profit. After that, it's pure profit for ${(calc.customerLifetime - calc.paybackMonths).toFixed(1)} more months.</p>`;
            explanation += '</div>';

            document.getElementById('payback_explanation').innerHTML = explanation;
        }

        function displayMarginChart(calc) {
            const ctx = document.getElementById('margin_chart');
            
            if (charts.margin) charts.margin.destroy();

            charts.margin = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Gross Profit', 'COGS'],
                    datasets: [{
                        data: [calc.grossProfit, calc.totalCOGS],
                        backgroundColor: ['#4caf50', '#f44336']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            const hostingCost = parseFloat(document.getElementById('hosting_cost').value);
            const supportCost = parseFloat(document.getElementById('support_cost').value);
            const otherCOGS = parseFloat(document.getElementById('other_cogs').value);

            let breakdown = `
                <div class="metric-explainer">
                    <h5>Gross Margin Breakdown</h5>
                    <p><strong>Revenue (ACV):</strong> ${formatCurrency(calc.acv)}</p>
                    <p><strong>COGS Breakdown:</strong></p>
                    <ul>
                        <li>Hosting: ${formatCurrency(hostingCost)} (${((hostingCost / calc.acv) * 100).toFixed(1)}%)</li>
                        <li>Support: ${formatCurrency(supportCost)} (${((supportCost / calc.acv) * 100).toFixed(1)}%)</li>
                        <li>Other: ${formatCurrency(otherCOGS)} (${((otherCOGS / calc.acv) * 100).toFixed(1)}%)</li>
                        <li><strong>Total COGS: ${formatCurrency(calc.totalCOGS)} (${((calc.totalCOGS / calc.acv) * 100).toFixed(1)}%)</strong></li>
                    </ul>
                    <p><strong>Gross Profit:</strong> ${formatCurrency(calc.grossProfit)} (${calc.grossMarginPercent.toFixed(1)}%)</p>
            `;

            if (calc.grossMarginPercent >= 80) {
                breakdown += '<p>‚úÖ <strong>Excellent margin!</strong> You have plenty of room to invest in growth.</p>';
            } else if (calc.grossMarginPercent >= 70) {
                breakdown += '<p>‚ö†Ô∏è <strong>Acceptable margin.</strong> Look for COGS optimization opportunities.</p>';
            } else {
                breakdown += '<p>üö® <strong>Low margin for SaaS.</strong> COGS are too high. Review hosting efficiency, support model, and delivery costs.</p>';
            }

            breakdown += '</div>';
            document.getElementById('margin_breakdown').innerHTML = breakdown;
        }

        function displayBenchmarks(calc) {
            const benchmarks = [
                {
                    metric: 'LTV:CAC Ratio',
                    your: calc.ltvCacRatio.toFixed(2) + ':1',
                    target: '3:1 - 5:1',
                    rating: calc.ltvCacRatio >= 3 ? 'excellent' : calc.ltvCacRatio >= 2 ? 'acceptable' : 'poor'
                },
                {
                    metric: 'Payback Period',
                    your: calc.paybackMonths.toFixed(1) + ' months',
                    target: '< 12 months',
                    rating: calc.paybackMonths <= 12 ? 'excellent' : calc.paybackMonths <= 18 ? 'acceptable' : 'poor'
                },
                {
                    metric: 'Gross Margin',
                    your: calc.grossMarginPercent.toFixed(1) + '%',
                    target: '75% - 85%',
                    rating: calc.grossMarginPercent >= 80 ? 'excellent' : calc.grossMarginPercent >= 70 ? 'good' : calc.grossMarginPercent >= 60 ? 'acceptable' : 'poor'
                },
                {
                    metric: 'CAC as % of ACV',
                    your: calc.cacPercent.toFixed(1) + '%',
                    target: '< 33%',
                    rating: calc.cacPercent <= 33 ? 'excellent' : calc.cacPercent <= 50 ? 'acceptable' : 'poor'
                },
                {
                    metric: 'Magic Number',
                    your: calc.magicNumber.toFixed(2),
                    target: '> 0.75',
                    rating: calc.magicNumber >= 0.75 ? 'excellent' : calc.magicNumber >= 0.5 ? 'good' : calc.magicNumber >= 0.3 ? 'acceptable' : 'poor'
                },
                {
                    metric: 'Monthly Churn',
                    your: (calc.churnRate * 100).toFixed(1) + '%',
                    target: '< 2%',
                    rating: calc.churnRate <= 0.02 ? 'excellent' : calc.churnRate <= 0.03 ? 'good' : calc.churnRate <= 0.05 ? 'acceptable' : 'poor'
                }
            ];

            let html = `
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Your Value</th>
                        <th>SaaS Benchmark</th>
                        <th>Rating</th>
                    </tr>
                </thead>
                <tbody>
            `;

            benchmarks.forEach(b => {
                html += `
                    <tr>
                        <td><strong>${b.metric}</strong></td>
                        <td>${b.your}</td>
                        <td>${b.target}</td>
                        <td><span class="benchmark-indicator benchmark-${b.rating}">${b.rating.toUpperCase()}</span></td>
                    </tr>
                `;
            });

            html += '</tbody>';
            document.getElementById('benchmarks_table').innerHTML = html;
        }

        function displayExportSummary(calc) {
            const html = `
                <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #667eea;">
                    <p style="margin-bottom: 10px;"><strong>‚úÖ Gross Margin:</strong> ${formatPercent(calc.grossMarginPercent)} (${formatCurrency(calc.grossProfit)} per customer)</p>
                    <p style="margin-bottom: 10px;"><strong>‚úÖ CAC:</strong> ${formatCurrency(calc.cac)} (${calc.cacPercent.toFixed(0)}% of ACV)</p>
                    <p style="margin-bottom: 10px;"><strong>‚úÖ LTV:</strong> ${formatCurrency(calc.ltv)} (${calc.ltvCacRatio.toFixed(2)}:1 ratio)</p>
                    <p style="margin-bottom: 10px;"><strong>‚úÖ Payback:</strong> ${calc.paybackMonths.toFixed(1)} months</p>
                    <p style="margin-bottom: 10px;"><strong>‚úÖ Customer Lifetime:</strong> ${calc.customerLifetime.toFixed(1)} months at ${formatPercent(calc.churnRate * 100)} churn</p>
                </div>
            `;

            document.getElementById('export_summary').innerHTML = html;
        }

        function displaySensitivityAnalysis(calc) {
            const scenarios = [
                {
                    name: 'Reduce CAC by 20%',
                    newCAC: calc.cac * 0.8,
                    newLTV: calc.ltv,
                    change: 'CAC'
                },
                {
                    name: 'Improve Margin by 5%',
                    newCAC: calc.cac,
                    newLTV: (calc.grossProfit * 1.05 / calc.grossProfit) * calc.ltv,
                    change: 'Margin'
                },
                {
                    name: 'Reduce Churn by 1%',
                    newCAC: calc.cac,
                    newLTV: (calc.grossProfit * (1 / (calc.churnRate - 0.01))),
                    change: 'Churn'
                },
                {
                    name: 'Increase ACV by 20%',
                    newCAC: calc.cac,
                    newLTV: calc.ltv * 1.2,
                    change: 'ACV'
                }
            ];

            let html = '<table class="comparison-table"><thead><tr><th>Scenario</th><th>New LTV:CAC</th><th>Impact</th></tr></thead><tbody>';

            scenarios.forEach(s => {
                const newRatio = s.newLTV / s.newCAC;
                const improvement = ((newRatio - calc.ltvCacRatio) / calc.ltvCacRatio) * 100;
                
                html += `
                    <tr>
                        <td><strong>${s.name}</strong></td>
                        <td>${newRatio.toFixed(2)}:1</td>
                        <td style="color: ${improvement > 0 ? '#4caf50' : '#f44336'};">
                            ${improvement > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(improvement).toFixed(1)}%
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';

            html += `
                <div class="metric-explainer">
                    <h5>Key Insight</h5>
                    <p>Small improvements in fundamentals compound into major gains. Focus on the lever with highest ROI:</p>
                    <ul>
                        <li><strong>Reducing CAC</strong> has immediate impact and improves payback</li>
                        <li><strong>Improving margin</strong> increases LTV and funds growth</li>
                        <li><strong>Reducing churn</strong> has exponential impact on LTV</li>
                        <li><strong>Increasing ACV</strong> directly improves all metrics</li>
                    </ul>
                </div>
            `;

            document.getElementById('sensitivity_analysis').innerHTML = html;
        }

        function exportToPlanner() {
            if (!currentCalculation) {
                alert('Please calculate unit economics first');
                return;
            }

            // Create URL with query parameters
            const params = new URLSearchParams({
                acv: currentCalculation.acv,
                churn: (currentCalculation.churnRate * 100).toFixed(2),
                cac: currentCalculation.cac.toFixed(0),
                gross_margin: currentCalculation.grossMarginPercent.toFixed(1),
                ltv: currentCalculation.ltv.toFixed(0),
                payback: currentCalculation.paybackMonths.toFixed(1),
                customers_per_month: currentCalculation.customersPerMonth,
                from_unit_economics: 'true'
            });

            window.location.href = 'Goal-Seeking-Revenue-Planner.html?' + params.toString();
        }
    </script>
</body>
</html>