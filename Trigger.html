<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Trigger Template System | BearOps</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0A1628 0%, #1a2942 100%);
            color: #ffffff;
            line-height: 1.6;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(10, 22, 40, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid rgba(52, 152, 219, 0.3);
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #0A1628;
        }

        .subtitle {
            font-size: 1.3rem;
            color: #3498db;
            margin-top: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .control-panel {
            background: rgba(52, 152, 219, 0.1);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid rgba(52, 152, 219, 0.3);
        }

        .control-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            align-items: end;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #3498db;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
            background: rgba(255, 255, 255, 0.15);
        }

        .form-control option {
            background: #1a2942;
            color: white;
        }

        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: rgba(52, 152, 219, 0.2);
            border: 2px solid #3498db;
            color: #3498db;
        }

        .btn-secondary:hover {
            background: rgba(52, 152, 219, 0.3);
        }

        .trigger-content {
            display: none;
        }

        .trigger-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid rgba(52, 152, 219, 0.3);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.4rem;
            color: #3498db;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th {
            background: rgba(52, 152, 219, 0.2);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        td {
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.03);
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.08);
        }

        .editable-cell {
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .editable-cell:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .editable-cell::after {
            content: '‚úé';
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.2s ease;
            color: #3498db;
        }

        .editable-cell:hover::after {
            opacity: 1;
        }

        .tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            margin: 2px;
            font-weight: 500;
        }

        .tag-cold { background: rgba(52, 152, 219, 0.3); color: #3498db; }
        .tag-warm { background: rgba(241, 196, 15, 0.3); color: #f39c12; }
        .tag-linkedin { background: rgba(155, 89, 182, 0.3); color: #9b59b6; }
        .tag-email { background: rgba(46, 204, 113, 0.3); color: #2ecc71; }
        .tag-phone { background: rgba(230, 126, 34, 0.3); color: #e67e22; }

        .add-row-btn {
            margin-top: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a2942 0%, #0A1628 100%);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            border: 2px solid #3498db;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            font-size: 1.5rem;
            color: #3498db;
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .trigger-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .trigger-card {
            background: rgba(52, 152, 219, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .trigger-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
        }

        .trigger-card-title {
            font-weight: 600;
            color: #3498db;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .info-box {
            background: rgba(241, 196, 15, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .info-box:hover {
            background: rgba(241, 196, 15, 0.15);
        }

        .info-box-title {
            color: #f39c12;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(52, 152, 219, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            background: rgba(52, 152, 219, 0.15);
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        #saveIndicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .control-row {
                grid-template-columns: 1fr;
            }
            
            .trigger-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Save Indicator -->
    <div id="saveIndicator">‚úì Saved</div>

    <div class="header">
        <div class="logo">
            <div class="logo-icon">B</div>
            BearOps Sales Trigger System
        </div>
        <div class="subtitle">Trigger-Based Prospecting Templates</div>
    </div>

    <div class="container">
        <!-- Control Panel -->
        <div class="control-panel">
            <div class="control-row">
                <div class="form-group" style="margin-bottom: 0;">
                    <label for="triggerSelect">Select Sales Trigger</label>
                    <select id="triggerSelect" class="form-control" onchange="loadTrigger()">
                        <option value="">-- Choose a Trigger --</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="openAddTriggerModal()">‚ûï Add New Trigger</button>
                    <button class="btn btn-secondary" onclick="openManageTriggersModal()">‚öôÔ∏è Manage Triggers</button>
                    <button class="btn btn-primary" onclick="exportData()">üì• Export All</button>
                </div>
            </div>
        </div>

        <!-- Trigger Content Area -->
        <div id="triggerContentArea"></div>

        <!-- Empty State -->
        <div id="emptyState" class="section" style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 4rem; margin-bottom: 20px;">üéØ</div>
            <h2 style="color: #3498db; margin-bottom: 15px;">No Trigger Selected</h2>
            <p style="color: rgba(255,255,255,0.7); margin-bottom: 25px;">Select a sales trigger from the dropdown above or create a new one to get started.</p>
            <button class="btn btn-primary" onclick="openAddTriggerModal()">Create Your First Trigger</button>
        </div>
    </div>

    <!-- Add Trigger Modal -->
    <div id="addTriggerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add New Sales Trigger</div>
            <div class="form-group">
                <label>Trigger Name</label>
                <input type="text" id="newTriggerName" class="form-control" placeholder="e.g., Funding Round, New Leadership, Expansion">
            </div>
            <div class="form-group">
                <label>Trigger Description</label>
                <textarea id="newTriggerDesc" class="form-control" placeholder="Describe when this trigger applies and why it creates a sales opportunity..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeAddTriggerModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveTrigger()">Save Trigger</button>
            </div>
        </div>
    </div>

    <!-- Manage Triggers Modal -->
    <div id="manageTriggersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Manage Sales Triggers</div>
            <div id="triggerListContainer" class="trigger-list"></div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closeManageTriggersModal()">Done</button>
            </div>
        </div>
    </div>

    <!-- Edit Cell Modal -->
    <div id="editCellModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Content</div>
            <div class="form-group">
                <label id="editCellLabel">Content</label>
                <textarea id="editCellInput" class="form-control" rows="5"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeEditCellModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveCell()">Save</button>
            </div>
        </div>
    </div>

    <script>
        // Default triggers data structure
        let triggers = {
            'funding-round': {
                name: 'Funding Round (Seed/Series A/B)',
                description: 'Company just raised capital and is looking to scale operations, hire talent, and invest in growth infrastructure.',
                overview: {
                    urgency: 'High - Companies have budget and pressure to deploy capital quickly',
                    buyingWindow: '3-6 months post-announcement',
                    idealTiming: 'Within 30 days of funding announcement',
                    keyStakeholders: 'CEO, CRO, VP Sales, VP Marketing, Head of RevOps'
                },
                signals: [
                    { signal: 'Crunchbase/TechCrunch announcement', source: 'News/PR', priority: 'High' },
                    { signal: 'LinkedIn posts from leadership', source: 'Social Media', priority: 'High' },
                    { signal: 'Job postings for sales/marketing roles', source: 'LinkedIn Jobs', priority: 'Medium' },
                    { signal: 'Expansion of office space', source: 'Company News', priority: 'Medium' },
                    { signal: 'New product launches or roadmap updates', source: 'Product Updates', priority: 'Low' }
                ],
                personas: [
                    { 
                        persona: 'CEO/Founder', 
                        painPoint: 'Need to scale revenue quickly to hit next milestone', 
                        valueMessage: 'Help you build repeatable revenue engine to justify next round',
                        objections: 'Budget concerns, bandwidth, existing systems'
                    },
                    { 
                        persona: 'CRO/VP Sales', 
                        painPoint: 'Pressure to hire and ramp team fast while building process', 
                        valueMessage: 'Give your team structure and best practices from day one',
                        objections: 'Not ready yet, want to build internally first'
                    },
                    { 
                        persona: 'VP Marketing', 
                        painPoint: 'Need to generate pipeline to support new sales hires', 
                        valueMessage: 'Align sales and marketing on common framework and messaging',
                        objections: 'Different priorities, focused on demand gen'
                    }
                ],
                messages: [
                    {
                        messageType: 'Cold Email',
                        subjectLine: 'Congrats on the [Series X] - Scaling Revenue at [Company]?',
                        template: `Hi [Name],

Saw the great news about [Company]'s [Series X] round - congrats! 

Having worked with [Similar Company 1] and [Similar Company 2] right after their funding rounds, I know this is when the pressure to scale revenue gets real. Most companies struggle with:

- Building repeatable sales process before hiring spree
- Getting new AEs productive in 60-90 days vs 6+ months  
- Aligning sales and marketing on messaging and ICP

We help funded startups build their revenue engine BEFORE scaling headcount - proven frameworks, not theory.

Worth a 15-min conversation? Happy to share our post-funding playbook.

[Your Name]`,
                        cadence: 'Day 1',
                        bestPractice: 'Mention their funding round specifically, show you understand their stage'
                    },
                    {
                        messageType: 'LinkedIn Message',
                        subjectLine: 'N/A',
                        template: `[Name] - just saw the [Series X] news, congratulations! 

Quick question: as you scale the team, do you have a structured sales process in place, or are you building it as you go?

Most founders tell us they wish they'd invested in process BEFORE hiring. Worth a quick chat?`,
                        cadence: 'Day 2',
                        bestPractice: 'Keep it short, ask a diagnostic question'
                    },
                    {
                        messageType: 'Phone/Voicemail',
                        subjectLine: 'N/A',
                        template: `Hi [Name], [Your Name] calling from BearOps. 

Congrats on the recent funding - I've been working with a few companies at your stage and wanted to share a common pattern we're seeing...

Most funded companies hire 5-10 AEs but don't have the infrastructure to make them successful. We help you build that foundation before you scale. 

Worth a quick conversation? You can reach me at [number] or I'll try you again tomorrow.`,
                        cadence: 'Day 4',
                        bestPractice: 'Reference pattern, create curiosity, low-pressure next step'
                    },
                    {
                        messageType: 'Value-Add Email',
                        subjectLine: 'Scaling Sales Post-Funding: Playbook for [Company]',
                        template: `Hi [Name],

Whether or not we work together, thought you might find this useful as you scale post-funding...

[Attach: "Post-Funding Sales Scaling Checklist" or similar resource]

Quick framework I share with all Series A/B companies:
‚úì Define your ICP and buying personas (Week 1-2)
‚úì Build core sales process and methodology (Week 3-4)  
‚úì Create messaging library and enablement content (Week 5-6)
‚úì THEN start hiring and onboarding reps (Week 7+)

Most companies do this backwards and lose 6 months.

Want to walk through how we'd approach this for [Company]?`,
                        cadence: 'Day 6',
                        bestPractice: 'Provide value first, framework shows expertise'
                    }
                ],
                research: [
                    { source: 'Crunchbase', dataPoint: 'Funding amount, investors, date', howToUse: 'Reference in outreach, gauge budget' },
                    { source: 'LinkedIn', dataPoint: 'Recent hires, job postings, leadership changes', howToUse: 'Identify growth signals and stakeholders' },
                    { source: 'Company Website', dataPoint: 'About page updates, careers page, press releases', howToUse: 'Understand growth priorities and messaging' },
                    { source: 'Tech Stack (BuiltWith)', dataPoint: 'Marketing and sales tools in use', howToUse: 'Understand maturity level and gaps' }
                ]
            },
            'new-leadership': {
                name: 'New CRO/VP Sales/Head of Sales',
                description: 'New sales leader joins with mandate to transform revenue operations, often bringing new methodologies and looking for quick wins.',
                overview: {
                    urgency: 'Very High - 90-day plan pressure, need quick wins',
                    buyingWindow: '0-4 months after start date',
                    idealTiming: 'Weeks 2-8 of their tenure',
                    keyStakeholders: 'New CRO/VP Sales, CEO, RevOps, Sales Team'
                },
                signals: [
                    { signal: 'LinkedIn job change announcement', source: 'LinkedIn', priority: 'High' },
                    { signal: 'Press release or company announcement', source: 'Company Website', priority: 'High' },
                    { signal: 'New leader posting about "first 90 days"', source: 'Social Media', priority: 'High' },
                    { signal: 'Sales team restructuring/new hires', source: 'LinkedIn', priority: 'Medium' }
                ],
                personas: [
                    { 
                        persona: 'New CRO/VP Sales', 
                        painPoint: 'Need to prove value fast, diagnose current state, implement changes', 
                        valueMessage: 'Accelerate your 90-day plan with proven frameworks and avoid common pitfalls',
                        objections: 'Want to assess internally first, already have a plan'
                    },
                    { 
                        persona: 'CEO', 
                        painPoint: 'Made expensive hire, need ROI quickly, concerned about disruption', 
                        valueMessage: 'Support your new leader with external expertise to ensure successful transformation',
                        objections: 'Let new leader settle in first'
                    }
                ],
                messages: [
                    {
                        messageType: 'Cold Email',
                        subjectLine: 'Welcome to [Company] + Your First 90 Days',
                        template: `Hi [Name],

Congrats on joining [Company] as [Title]! Saw your announcement on LinkedIn.

I work with new sales leaders in their first 90 days - the pressure to diagnose, plan, and execute quickly is real. Most successful leaders I work with follow this pattern:

Days 1-30: Assess current state (process, people, tech, messaging)
Days 31-60: Design future state (what needs to change)  
Days 61-90: Quick wins (show progress to leadership)

Where most leaders struggle:
- Inheriting undefined sales process and no documentation
- Team using different methodologies and messaging  
- Unclear on what "good" looks like for their stage

We help new sales leaders build their transformation roadmap fast - proven frameworks from 50+ similar transformations.

Worth a conversation as you're ramping up?`,
                        cadence: 'Day 1',
                        bestPractice: 'Show you understand their situation, provide framework'
                    },
                    {
                        messageType: 'LinkedIn Message',
                        subjectLine: 'N/A',
                        template: `[Name] - welcome to [Company]! 

Quick question: what's your biggest priority in your first 90 days - sales process, team structure, or go-to-market strategy?

Happy to share what's worked for other new CROs at companies like yours.`,
                        cadence: 'Day 3',
                        bestPractice: 'Ask about priorities, offer pattern recognition'
                    }
                ],
                research: [
                    { source: 'LinkedIn', dataPoint: 'Previous companies, background, methodology experience', howToUse: 'Tailor message to their experience level' },
                    { source: 'Company Website', dataPoint: 'Current go-to-market, team size, stage', howToUse: 'Understand what they inherited' },
                    { source: 'Mutual Connections', dataPoint: 'Can anyone introduce you?', howToUse: 'Warm intro is 10x better than cold' }
                ]
            },
            'geographic-expansion': {
                name: 'Geographic Expansion (New Region/Country)',
                description: 'Company opening sales operations in new geography - EMEA expansion, new country entry, or regional office setup.',
                overview: {
                    urgency: 'High - Expansion timelines are aggressive',
                    buyingWindow: '2-6 months before/after expansion announcement',
                    idealTiming: 'During planning phase or first 60 days of new region',
                    keyStakeholders: 'Regional Sales Leader, Global CRO, Regional VP, Country Manager'
                },
                signals: [
                    { signal: 'Job postings for regional sales roles', source: 'LinkedIn Jobs', priority: 'High' },
                    { signal: 'Office opening announcements', source: 'Company News', priority: 'High' },
                    { signal: 'Leadership hiring in new region', source: 'LinkedIn', priority: 'High' },
                    { signal: 'Product localization updates', source: 'Product Releases', priority: 'Medium' }
                ],
                personas: [
                    { 
                        persona: 'Regional VP/Country Manager', 
                        painPoint: 'Building sales team from scratch, adapting US playbook to local market', 
                        valueMessage: 'Avoid 12 months of trial and error - proven regional expansion frameworks',
                        objections: 'Different market dynamics, need local expertise'
                    },
                    { 
                        persona: 'Global CRO', 
                        painPoint: 'Ensuring regional team follows company methodology while adapting locally', 
                        valueMessage: 'Give your regional teams structured playbook with local flexibility',
                        objections: 'Regional leaders should figure it out'
                    }
                ],
                messages: [
                    {
                        messageType: 'Cold Email',
                        subjectLine: 'EMEA Expansion at [Company] - Sales Process & Methodology?',
                        template: `Hi [Name],

Noticed [Company] is expanding into [Region] - exciting move!

Having worked with [Similar Company 1] and [Similar Company 2] on their EMEA launches, I know the challenge: replicating US success in new markets without just copying the playbook.

Most common mistakes:
- No defined ICP for regional markets (different buyer behavior)
- US-centric messaging that doesn't resonate locally  
- Hiring fast but no structured onboarding or methodology
- Long ramp times because reps are figuring it out alone

We help companies build regional sales infrastructure - methodology, messaging, and enablement - before you scale the team.

Worth exploring as you build out [Region]?`,
                        cadence: 'Day 1',
                        bestPractice: 'Show experience with regional expansion, call out common pitfalls'
                    }
                ],
                research: [
                    { source: 'LinkedIn', dataPoint: 'Regional hiring activity, new sales roles', howToUse: 'Understand expansion timeline' },
                    { source: 'Company News', dataPoint: 'Expansion announcements, office openings', howToUse: 'Reference in outreach' }
                ]
            }
        };

        let currentTrigger = '';
        let currentEditCell = null;
        let saveTimeout;

        // Initialize
        function init() {
            loadTriggers();
            if (Object.keys(triggers).length === 0) {
                document.getElementById('emptyState').style.display = 'block';
            } else {
                document.getElementById('emptyState').style.display = 'none';
            }
        }

        function loadTriggers() {
            const select = document.getElementById('triggerSelect');
            select.innerHTML = '<option value="">-- Choose a Trigger --</option>';
            
            Object.keys(triggers).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = triggers[key].name;
                select.appendChild(option);
            });
        }

        function loadTrigger() {
            const triggerKey = document.getElementById('triggerSelect').value;
            if (!triggerKey) {
                document.getElementById('triggerContentArea').innerHTML = '';
                document.getElementById('emptyState').style.display = 'block';
                return;
            }

            document.getElementById('emptyState').style.display = 'none';
            currentTrigger = triggerKey;
            const trigger = triggers[triggerKey];

            const content = `
                <div class="trigger-content active">
                    <!-- Trigger Overview -->
                    <div class="section">
                        <div class="section-header">
                            <h2 class="section-title">üéØ ${trigger.name}</h2>
                        </div>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 20px;">${trigger.description}</p>
                        
                        <div class="stats-grid">
                            <div class="stat-card" onclick="editOverview('urgency')" title="Click to edit">
                                <div class="stat-label">Urgency Level</div>
                                <div class="stat-value">${trigger.overview.urgency.split(' - ')[0]}</div>
                                <div class="stat-label">${trigger.overview.urgency.split(' - ')[1] || ''}</div>
                            </div>
                            <div class="stat-card" onclick="editOverview('buyingWindow')" title="Click to edit">
                                <div class="stat-label">Buying Window</div>
                                <div class="stat-value" style="font-size: 1.3rem;">${trigger.overview.buyingWindow}</div>
                            </div>
                            <div class="stat-card" onclick="editOverview('idealTiming')" title="Click to edit">
                                <div class="stat-label">Ideal Timing</div>
                                <div class="stat-value" style="font-size: 1.3rem;">${trigger.overview.idealTiming}</div>
                            </div>
                        </div>
                        
                        <div class="info-box" onclick="editOverview('keyStakeholders')" title="Click to edit">
                            <div class="info-box-title">Key Stakeholders</div>
                            <p style="color: rgba(255,255,255,0.8);">${trigger.overview.keyStakeholders}</p>
                        </div>
                    </div>

                    <!-- Trigger Signals -->
                    <div class="section">
                        <div class="section-header">
                            <h3 class="section-title">üîî Trigger Signals & Data Sources</h3>
                            <button class="btn btn-secondary btn-sm" onclick="addSignalRow()">‚ûï Add Signal</button>
                        </div>
                        <div class="table-container">
                            <table id="signalsTable">
                                <thead>
                                    <tr>
                                        <th style="width: 40%">Signal/Event</th>
                                        <th style="width: 25%">Data Source</th>
                                        <th style="width: 20%">Priority</th>
                                        <th style="width: 15%">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${trigger.signals.map((s, i) => `
                                        <tr>
                                            <td class="editable-cell" onclick="editCell(this, 'signals', ${i}, 'signal')">${s.signal}</td>
                                            <td class="editable-cell" onclick="editCell(this, 'signals', ${i}, 'source')">${s.source}</td>
                                            <td class="editable-cell" onclick="editCell(this, 'signals', ${i}, 'priority')">
                                                <span class="tag ${s.priority.toLowerCase() === 'high' ? 'tag-email' : s.priority.toLowerCase() === 'medium' ? 'tag-warm' : 'tag-cold'}">${s.priority}</span>
                                            </td>
                                            <td>
                                                <button class="btn btn-danger btn-sm" onclick="deleteRow('signals', ${i})" style="padding: 5px 10px; font-size: 0.8rem;">üóëÔ∏è</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Target Personas -->
                    <div class="section">
                        <div class="section-header">
                            <h3 class="section-title">üë• Target Personas & Messaging</h3>
                            <button class="btn btn-secondary btn-sm" onclick="addPersonaRow()">‚ûï Add Persona</button>
                        </div>
                        <div class="table-container">
                            <table id="personasTable">
                                <thead>
                                    <tr>
                                        <th style="width: 20%">Persona/Title</th>
                                        <th style="width: 25%">Pain Point</th>
                                        <th style="width: 30%">Value Message</th>
                                        <th style="width: 20%">Common Objections</th>
                                        <th style="width: 5%">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${trigger.personas.map((p, i) => `
                                        <tr>
                                            <td class="editable-cell" onclick="editCell(this, 'personas', ${i}, 'persona')">${p.persona}</td>
                                            <td class="editable-cell" onclick="editCell(this, 'personas', ${i}, 'painPoint')">${p.painPoint}</td>
                                            <td class="editable-cell" onclick="editCell(this, 'personas', ${i}, 'valueMessage')">${p.valueMessage}</td>
                                            <td class="editable-cell" onclick="editCell(this, 'personas', ${i}, 'objections')">${p.objections}</td>
                                            <td>
                                                <button class="btn btn-danger btn-sm" onclick="deleteRow('personas', ${i})" style="padding: 5px 10px; font-size: 0.8rem;">üóëÔ∏è</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Message Templates -->
                    <div class="section">
                        <div class="section-header">
                            <h3 class="section-title">üí¨ Message Templates & Sequences</h3>
                            <button class="btn btn-secondary btn-sm" onclick="addMessageRow()">‚ûï Add Message</button>
                        </div>
                        <div class="table-container">
                            <table id="messagesTable">
                                <thead>
                                    <tr>
                                        <th style="width: 15%">Message Type</th>
                                        <th style="width: 20%">Subject Line</th>
                                        <th style="width: 35%">Template</th>
                                        <th style="width: 10%">Cadence</th>
                                        <th style="width: 15%">Best Practice</th>
                                        <th style="width: 5%">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${trigger.messages.map((m, i) => `
                                        <tr>
                                            <td class="editable-cell" onclick="editCell(this, 'messages', ${i}, 'messageType')">
                                                <span class="tag ${getMessageTypeTag(m.messageType)}">${m.messageType}</span>
                                            </td>
                                            <td class="editable-cell" onclick="editCell(this, 'messages', ${i}, 'subjectLine')">${m.subjectLine}</td>
                                            <td class="editable-cell" onclick="editCell(this, 'messages', ${i}, 'template')" style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${m.template.substring(0, 60)}...</td>
                                            <td class="editable-cell" onclick="editCell(this, 'messages', ${i}, 'cadence')">${m.cadence}</td>
                                            <td class="editable-cell" onclick="editCell(this, 'messages', ${i}, 'bestPractice')">${m.bestPractice}</td>
                                            <td>
                                                <button class="btn btn-danger btn-sm" onclick="deleteRow('messages', ${i})" style="padding: 5px 10px; font-size: 0.8rem;">üóëÔ∏è</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Research & Intelligence -->
                    <div class="section">
                        <div class="section-header">
                            <h3 class="section-title">üîç Research & Intelligence Gathering</h3>
                            <button class="btn btn-secondary btn-sm" onclick="addResearchRow()">‚ûï Add Source</button>
                        </div>
                        <div class="table-container">
                            <table id="researchTable">
                                <thead>
                                    <tr>
                                        <th style="width: 25%">Data Source</th>
                                        <th style="width: 35%">What to Look For</th>
                                        <th style="width: 35%">How to Use in Outreach</th>
                                        <th style="width: 5%">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${trigger.research.map((r, i) => `
                                        <tr>
                                            <td class="editable-cell" onclick="editCell(this, 'research', ${i}, 'source')">${r.source}</td>
                                            <td class="editable-cell" onclick="editCell(this, 'research', ${i}, 'dataPoint')">${r.dataPoint}</td>
                                            <td class="editable-cell" onclick="editCell(this, 'research', ${i}, 'howToUse')">${r.howToUse}</td>
                                            <td>
                                                <button class="btn btn-danger btn-sm" onclick="deleteRow('research', ${i})" style="padding: 5px 10px; font-size: 0.8rem;">üóëÔ∏è</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('triggerContentArea').innerHTML = content;
        }

        function getMessageTypeTag(type) {
            const tagMap = {
                'Cold Email': 'tag-email',
                'LinkedIn Message': 'tag-linkedin',
                'Phone/Voicemail': 'tag-phone',
                'Value-Add Email': 'tag-warm',
                'Warm Email': 'tag-warm'
            };
            return tagMap[type] || 'tag-cold';
        }

        // NEW FUNCTION: Edit overview fields
        function editOverview(field) {
            const currentValue = triggers[currentTrigger].overview[field];
            
            currentEditCell = { 
                tableType: 'overview', 
                field: field 
            };
            
            document.getElementById('editCellLabel').textContent = field.charAt(0).toUpperCase() + field.slice(1).replace(/([A-Z])/g, ' $1');
            document.getElementById('editCellInput').value = currentValue;
            document.getElementById('editCellModal').classList.add('active');
        }

        function editCell(cell, tableType, rowIndex, field) {
            currentEditCell = { tableType, rowIndex, field, cell };
            const currentValue = triggers[currentTrigger][tableType][rowIndex][field];
            
            document.getElementById('editCellLabel').textContent = field.charAt(0).toUpperCase() + field.slice(1);
            document.getElementById('editCellInput').value = currentValue;
            document.getElementById('editCellModal').classList.add('active');
        }

        // UPDATED FUNCTION: Handle both table cells and overview fields
        function saveCell() {
            if (!currentEditCell) return;
            
            const newValue = document.getElementById('editCellInput').value;
            
            // Handle overview edits differently
            if (currentEditCell.tableType === 'overview') {
                triggers[currentTrigger].overview[currentEditCell.field] = newValue;
            } else {
                triggers[currentTrigger][currentEditCell.tableType][currentEditCell.rowIndex][currentEditCell.field] = newValue;
            }
            
            closeEditCellModal();
            loadTrigger();
            saveToLocalStorage();
        }

        function closeEditCellModal() {
            document.getElementById('editCellModal').classList.remove('active');
            currentEditCell = null;
        }

        function deleteRow(tableType, rowIndex) {
            if (confirm('Are you sure you want to delete this row?')) {
                triggers[currentTrigger][tableType].splice(rowIndex, 1);
                loadTrigger();
                saveToLocalStorage();
            }
        }

        function addSignalRow() {
            triggers[currentTrigger].signals.push({
                signal: 'New signal/event',
                source: 'Data source',
                priority: 'Medium'
            });
            loadTrigger();
            saveToLocalStorage();
        }

        function addPersonaRow() {
            triggers[currentTrigger].personas.push({
                persona: 'New Persona',
                painPoint: 'Describe their pain point',
                valueMessage: 'Your value proposition',
                objections: 'Common objections'
            });
            loadTrigger();
            saveToLocalStorage();
        }

        function addMessageRow() {
            triggers[currentTrigger].messages.push({
                messageType: 'Cold Email',
                subjectLine: 'Your subject line',
                template: 'Your message template...',
                cadence: 'Day X',
                bestPractice: 'Best practice note'
            });
            loadTrigger();
            saveToLocalStorage();
        }

        function addResearchRow() {
            triggers[currentTrigger].research.push({
                source: 'Data source',
                dataPoint: 'What to look for',
                howToUse: 'How to use in outreach'
            });
            loadTrigger();
            saveToLocalStorage();
        }

        function openAddTriggerModal() {
            document.getElementById('addTriggerModal').classList.add('active');
        }

        function closeAddTriggerModal() {
            document.getElementById('addTriggerModal').classList.remove('active');
            document.getElementById('newTriggerName').value = '';
            document.getElementById('newTriggerDesc').value = '';
        }

        function saveTrigger() {
            const name = document.getElementById('newTriggerName').value.trim();
            const desc = document.getElementById('newTriggerDesc').value.trim();
            
            if (!name) {
                alert('Please enter a trigger name');
                return;
            }

            const key = name.toLowerCase().replace(/[^a-z0-9]/g, '-');
            
            triggers[key] = {
                name: name,
                description: desc || 'No description provided',
                overview: {
                    urgency: 'Medium - Update as needed',
                    buyingWindow: 'Define buying window',
                    idealTiming: 'Define ideal timing',
                    keyStakeholders: 'List key stakeholders'
                },
                signals: [],
                personas: [],
                messages: [],
                research: []
            };

            closeAddTriggerModal();
            loadTriggers();
            document.getElementById('triggerSelect').value = key;
            loadTrigger();
            saveToLocalStorage();
        }

        function openManageTriggersModal() {
            const container = document.getElementById('triggerListContainer');
            container.innerHTML = '';
            
            Object.keys(triggers).forEach(key => {
                const trigger = triggers[key];
                const card = document.createElement('div');
                card.className = 'trigger-card';
                card.innerHTML = `
                    <div>
                        <div class="trigger-card-title">${trigger.name}</div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.6); margin-top: 5px;">
                            ${trigger.signals.length} signals | ${trigger.personas.length} personas | ${trigger.messages.length} messages
                        </div>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="deleteTrigger('${key}')" style="padding: 8px 15px;">Delete</button>
                `;
                container.appendChild(card);
            });

            document.getElementById('manageTriggersModal').classList.add('active');
        }

        function closeManageTriggersModal() {
            document.getElementById('manageTriggersModal').classList.remove('active');
        }

        function deleteTrigger(key) {
            if (confirm(`Are you sure you want to delete "${triggers[key].name}"?`)) {
                delete triggers[key];
                
                // If we're deleting the currently viewed trigger, clear the view
                if (currentTrigger === key) {
                    currentTrigger = '';
                    document.getElementById('triggerContentArea').innerHTML = '';
                    document.getElementById('triggerSelect').value = '';
                    
                    // Show empty state if no triggers left
                    if (Object.keys(triggers).length === 0) {
                        document.getElementById('emptyState').style.display = 'block';
                    }
                }
                
                saveToLocalStorage();
                loadTriggers();
                
                // Refresh the manage triggers modal to show updated list
                openManageTriggersModal();
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(triggers, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'sales-triggers-export.json';
            link.click();
        }

        // UPDATED FUNCTION: Save to localStorage with visual feedback
        function saveToLocalStorage() {
            localStorage.setItem('bearops-triggers', JSON.stringify(triggers));
            showSaveIndicator();
        }

        // NEW FUNCTION: Show save indicator
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            
            // Show the indicator
            indicator.style.opacity = '1';
            
            // Hide after 2 seconds
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                indicator.style.opacity = '0';
            }, 2000);
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('bearops-triggers');
            if (saved) {
                try {
                    triggers = JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        // NEW FEATURE: Auto-backup every 5 minutes
        setInterval(() => {
            if (Object.keys(triggers).length > 0) {
                saveToLocalStorage();
                console.log('Auto-backup completed at', new Date().toLocaleTimeString());
            }
        }, 5 * 60 * 1000); // 5 minutes

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });

        // Load data and initialize
        loadFromLocalStorage();
        init();
    </script>
</body>
</html>